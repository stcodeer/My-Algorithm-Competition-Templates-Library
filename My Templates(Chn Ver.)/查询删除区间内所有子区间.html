<html>
<head>
  <title>查询删除区间内所有子区间</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1653"/>
<h1>查询删除区间内所有子区间</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">区间由左右端点表示，对于每个左端点在线段树上维护右端点最远已经删到第<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span></span></span></span>个位置，那么查询并删除区间内子区间个数的操作变成了将<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.75em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">[</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.02778em; -ms-high-contrast-adjust: none;">r</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">]</span></span></span></span>分别与<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.02778em; -ms-high-contrast-adjust: none;">r</span></span></span></span>取<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>。注意到<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span></span></span></span>序列单调不降，所以取<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>后会发生改变的<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span></span></span></span>一定是连续的区间<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.75em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">[</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.00773em; -ms-high-contrast-adjust: none;">R</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">]</span></span></span></span>，在线段树上二分第一个<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span></span></span></span>值小于<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.02778em; -ms-high-contrast-adjust: none;">r</span></span></span></span>的位置即可。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;bits/stdc++.h&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">typedef</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> ll;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2e5</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> Case;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,a[N];
ll ans;

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ST</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tot;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> ls[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>],rs[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>],mn[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>],tag[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	ll sum[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">up</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span></span>{
		mn[x]=mn[ls[x]];
		sum[x]=sum[ls[x]]+sum[rs[x]];
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">down</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!tag[x])<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(ls[x]){
			tag[ls[x]]=tag[x];
			mn[ls[x]]=tag[x];
			sum[ls[x]]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*tag[x]*(mid-l+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(rs[x]){
			tag[rs[x]]=tag[x];
			mn[rs[x]]=tag[x];
			sum[rs[x]]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*tag[x]*(r-mid);
		}
		tag[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">build</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=++tot;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r){
			mn[x]=sum[x]=l<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		ls[x]=build(l,mid);
		rs[x]=build(mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r);
		up(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">change</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> L,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> R,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=l&amp;&amp;r&lt;=R){
			mn[x]=d;
			sum[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*d*(r-l+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
			tag[x]=d;
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
		}
		down(x,l,r);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=mid)change(ls[x],l,mid,L,R,d);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(R&gt;mid)change(rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,L,R,d);
		up(x);
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">getlast</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> l;
		down(x,l,r);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mn[rs[x]]&lt;d)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> getlast(rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,d);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> getlast(ls[x],l,mid,d);
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">init</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
		mn[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e9</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=tot;++i){
			ls[i]=rs[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
			mn[i]=sum[i]=tag[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		}
		tot=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> root=build(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n);
	}
}T;

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ll <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">Solve</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l&gt;r||T.mn[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]&gt;=r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> p=T.getlast(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,r);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(p&lt;l)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	ll ret=T.sum[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	T.change(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,l,p,r);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> T.sum[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]-ret;
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
	<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;Case);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(Case--){
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;n);
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">memset</span>(a,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">sizeof</span>(a));
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,x;i&lt;=n;++i){
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;x);
			a[x]=i;
		}
		T.init();
		ans=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=N<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;i;--i){
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">vector</span>&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>&gt;g;
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> j=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i*j&lt;N;++j)
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(a[i*j]){
				g.push_back(a[i*j]);
			}
			sort(g.begin(),g.end());
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> m=g.size();
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(m&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">continue</span>;
			ll tot=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
			tot+=Solve(g[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n);
			tot+=Solve(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,g[m<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-2</span>]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>);
			tot+=Solve(g[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,g[m<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>);
			ans+=tot*i;
		}
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%lld\n&quot;</span>,ans);
	}
}

</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%E5%8C%BA%E9%97%B4%E7%94%B1%E5%B7%A6%E5%8F%B3%E7%AB%AF%E7%82%B9%E8%A1%A8%E7%A4%BA%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%AF%8F%E4%B8%AA%E5%B7%A6%E7%AB%AF%E7%82%B9%E5%9C%A8%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%8A%E7%BB%B4%E6%8A%A4%E5%8F%B3%E7%AB%AF%E7%82%B9%E6%9C%80%E8%BF%9C%E5%B7%B2%E7%BB%8F%E5%88%A0%E5%88%B0%E7%AC%AC%24pos%24%E4%B8%AA%E4%BD%8D%E7%BD%AE%EF%BC%8C%E9%82%A3%E4%B9%88%E6%9F%A5%E8%AF%A2%E5%B9%B6%E5%88%A0%E9%99%A4%E5%8C%BA%E9%97%B4%E5%86%85%E5%AD%90%E5%8C%BA%E9%97%B4%E4%B8%AA%E6%95%B0%E7%9A%84%E6%93%8D%E4%BD%9C%E5%8F%98%E6%88%90%E4%BA%86%E5%B0%86%24pos%5Bl...r%5D%24%E5%88%86%E5%88%AB%E4%B8%8E%24r%24%E5%8F%96%24max%24%E3%80%82%E6%B3%A8%E6%84%8F%E5%88%B0%24pos%24%E5%BA%8F%E5%88%97%E5%8D%95%E8%B0%83%E4%B8%8D%E9%99%8D%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%96%24max%24%E5%90%8E%E4%BC%9A%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98%E7%9A%84%24pos%24%E4%B8%80%E5%AE%9A%E6%98%AF%E8%BF%9E%E7%BB%AD%E7%9A%84%E5%8C%BA%E9%97%B4%24%5Bl..R%5D%24%EF%BC%8C%E5%9C%A8%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%8A%E4%BA%8C%E5%88%86%E7%AC%AC%E4%B8%80%E4%B8%AA%24pos%24%E5%80%BC%E5%B0%8F%E4%BA%8E%24r%24%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%60%60%60c%2B%2B%0A%23include%3Cbits%2Fstdc%2B%2B.h%3E%0Ausing%20namespace%20std%3B%0Atypedef%20long%20long%20ll%3B%0Aconst%20int%20N%20%3D%202e5%2B1%3B%0A%0Aint%20Case%3B%0Aint%20n%2Ca%5BN%5D%3B%0All%20ans%3B%0A%0Astruct%20ST%7B%0A%09int%20tot%3B%0A%09int%20ls%5BN%3C%3C1%5D%2Crs%5BN%3C%3C1%5D%2Cmn%5BN%3C%3C1%5D%2Ctag%5BN%3C%3C1%5D%3B%0A%09ll%20sum%5BN%3C%3C1%5D%3B%0A%09void%20up(int%20x)%7B%0A%09%09mn%5Bx%5D%3Dmn%5Bls%5Bx%5D%5D%3B%0A%09%09sum%5Bx%5D%3Dsum%5Bls%5Bx%5D%5D%2Bsum%5Brs%5Bx%5D%5D%3B%0A%09%7D%0A%09void%20down(int%20x%2Cint%20l%2Cint%20r)%7B%0A%09%09if(!tag%5Bx%5D)return%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(ls%5Bx%5D)%7B%0A%09%09%09tag%5Bls%5Bx%5D%5D%3Dtag%5Bx%5D%3B%0A%09%09%09mn%5Bls%5Bx%5D%5D%3Dtag%5Bx%5D%3B%0A%09%09%09sum%5Bls%5Bx%5D%5D%3D1ll*tag%5Bx%5D*(mid-l%2B1)%3B%0A%09%09%7D%0A%09%09if(rs%5Bx%5D)%7B%0A%09%09%09tag%5Brs%5Bx%5D%5D%3Dtag%5Bx%5D%3B%0A%09%09%09mn%5Brs%5Bx%5D%5D%3Dtag%5Bx%5D%3B%0A%09%09%09sum%5Brs%5Bx%5D%5D%3D1ll*tag%5Bx%5D*(r-mid)%3B%0A%09%09%7D%0A%09%09tag%5Bx%5D%3D0%3B%0A%09%7D%0A%09int%20build(int%20l%2Cint%20r)%7B%0A%09%09int%20x%3D%2B%2Btot%3B%0A%09%09if(l%3D%3Dr)%7B%0A%09%09%09mn%5Bx%5D%3Dsum%5Bx%5D%3Dl-1%3B%0A%09%09%09return%20x%3B%0A%09%09%7D%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09ls%5Bx%5D%3Dbuild(l%2Cmid)%3B%0A%09%09rs%5Bx%5D%3Dbuild(mid%2B1%2Cr)%3B%0A%09%09up(x)%3B%0A%09%09return%20x%3B%0A%09%7D%0A%09void%20change(int%20x%2Cint%20l%2Cint%20r%2Cint%20L%2Cint%20R%2Cint%20d)%7B%0A%09%09if(L%3C%3Dl%26%26r%3C%3DR)%7B%0A%09%09%09mn%5Bx%5D%3Dd%3B%0A%09%09%09sum%5Bx%5D%3D1ll*d*(r-l%2B1)%3B%0A%09%09%09tag%5Bx%5D%3Dd%3B%0A%09%09%09return%3B%0A%09%09%7D%0A%09%09down(x%2Cl%2Cr)%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(L%3C%3Dmid)change(ls%5Bx%5D%2Cl%2Cmid%2CL%2CR%2Cd)%3B%0A%09%09if(R%3Emid)change(rs%5Bx%5D%2Cmid%2B1%2Cr%2CL%2CR%2Cd)%3B%0A%09%09up(x)%3B%0A%09%7D%0A%09int%20getlast(int%20x%2Cint%20l%2Cint%20r%2Cint%20d)%7B%0A%09%09if(l%3D%3Dr)return%20l%3B%0A%09%09down(x%2Cl%2Cr)%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(mn%5Brs%5Bx%5D%5D%3Cd)return%20getlast(rs%5Bx%5D%2Cmid%2B1%2Cr%2Cd)%3B%0A%09%09return%20getlast(ls%5Bx%5D%2Cl%2Cmid%2Cd)%3B%0A%09%7D%0A%09void%20init()%7B%0A%09%09mn%5B0%5D%3D1e9%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dtot%3B%2B%2Bi)%7B%0A%09%09%09ls%5Bi%5D%3Drs%5Bi%5D%3D0%3B%0A%09%09%09mn%5Bi%5D%3Dsum%5Bi%5D%3Dtag%5Bi%5D%3D0%3B%0A%09%09%7D%0A%09%09tot%3D0%3B%0A%09%09int%20root%3Dbuild(1%2Cn)%3B%0A%09%7D%0A%7DT%3B%0A%0All%20Solve(int%20l%2Cint%20r)%7B%0A%09if(l%3Er%7C%7CT.mn%5B1%5D%3E%3Dr)return%200%3B%0A%09int%20p%3DT.getlast(1%2C1%2Cn%2Cr)%3B%0A%09if(p%3Cl)return%200%3B%0A%09ll%20ret%3DT.sum%5B1%5D%3B%0A%09T.change(1%2C1%2Cn%2Cl%2Cp%2Cr)%3B%0A%09return%20T.sum%5B1%5D-ret%3B%0A%7D%0A%0Aint%20main()%7B%0A%09scanf(%22%25d%22%2C%26Case)%3B%0A%09while(Case--)%7B%0A%09%09scanf(%22%25d%22%2C%26n)%3B%0A%09%09memset(a%2C0%2Csizeof(a))%3B%0A%09%09for(int%20i%3D1%2Cx%3Bi%3C%3Dn%3B%2B%2Bi)%7B%0A%09%09%09scanf(%22%25d%22%2C%26x)%3B%0A%09%09%09a%5Bx%5D%3Di%3B%0A%09%09%7D%0A%09%09T.init()%3B%0A%09%09ans%3D0%3B%0A%09%09for(int%20i%3DN-1%3Bi%3B--i)%7B%0A%09%09%09vector%3Cint%3Eg%3B%0A%09%09%09for(int%20j%3D1%3Bi*j%3CN%3B%2B%2Bj)%0A%09%09%09if(a%5Bi*j%5D)%7B%0A%09%09%09%09g.push_back(a%5Bi*j%5D)%3B%0A%09%09%09%7D%0A%09%09%09sort(g.begin()%2Cg.end())%3B%0A%09%09%09int%20m%3Dg.size()%3B%0A%09%09%09if(m%3C2)continue%3B%0A%09%09%09ll%20tot%3D0%3B%0A%09%09%09tot%2B%3DSolve(g%5B1%5D%2B1%2Cn)%3B%0A%09%09%09tot%2B%3DSolve(1%2Cg%5Bm-2%5D-1)%3B%0A%09%09%09tot%2B%3DSolve(g%5B0%5D%2B1%2Cg%5Bm-1%5D-1)%3B%0A%09%09%09ans%2B%3Dtot*i%3B%0A%09%09%7D%0A%09%09printf(%22%25lld%5Cn%22%2Cans)%3B%0A%09%7D%0A%7D%0A%0A%60%60%60</center></span>
</div></body></html> 
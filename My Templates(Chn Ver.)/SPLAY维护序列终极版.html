<html>
<head>
  <title>SPLAY维护序列终极版</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2195"/>
<h1>SPLAY维护序列终极版</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1：插入 INSERT⁡ \ pos_i \ tot \ c_1 c_2⋯c_{tot}</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在当前数列的第 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 个数字后插入 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span> 个数字：<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">2</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">⋯</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.2805559999999999em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span>；若在数列首插入，则 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 为 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.64444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.64444em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">0</span></span></span></span></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">2：删除 DELETE ⁡\ pos_i \ tot</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从当前数列的第 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 个数字开始连续删除 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span> 个数字</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">3：修改 MAKE-SAME⁡ \ pos_i \ tot \ c</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从当前数列的第 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 个数字开始的连续 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span> 个数字统一修改为 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span></span></span></span></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">4：翻转 REVERSE⁡ \ pos_i \ tot</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">取出从当前数列的第 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 个数字开始的 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span> 个数字，翻转后放入原来的位置</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">5：求和 GET-SUM ⁡\ pos_i \ tot</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">计算从当前数列的第 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span> 个数字开始的 <span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.61508em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">t</span></span></span></span> 个数字的和并输出</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">6：求和最大的子列 MAX-SUM⁡</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">求出当前数列中和最大的一段子列，并输出最大和</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;iostream&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;cstdio&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;cstring&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;algorithm&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;queue&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> inf = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1000000000</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e6</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">read</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,f=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">char</span> ch=getchar();
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(ch&lt;<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'0'</span>||ch&gt;<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'9'</span>){<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(ch==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'-'</span>)f=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;ch=getchar();}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(ch&gt;=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'0'</span>&amp;&amp;ch&lt;=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'9'</span>){x=x*<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">10</span>+ch-<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'0'</span>;ch=getchar();}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x*f;
}
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,m,rt,cnt;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> a[N],id[N],fa[N],son[N][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>];
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> sum[N],sz[N],v[N],mx[N],lx[N],rx[N];
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span> tag[N],rev[N];
<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">queue</span>&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>&gt;q;<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//recycle</span>
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">update</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],r=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	sum[x]=sum[l]+sum[r]+v[x];
	sz[x]=sz[l]+sz[r]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
	mx[x]=max(mx[l],mx[r]);
	mx[x]=max(mx[x],rx[l]+v[x]+lx[r]);
	lx[x]=max(lx[l],sum[l]+v[x]+lx[r]);
	rx[x]=max(rx[r],sum[r]+v[x]+rx[l]);
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">pushdown</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],r=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(tag[x])
	{
		rev[x]=tag[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l)tag[l]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,v[l]=v[x],sum[l]=v[x]*sz[l];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(r)tag[r]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,v[r]=v[x],sum[r]=v[x]*sz[r];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(v[x]&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>)
		{
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l)lx[l]=rx[l]=mx[l]=sum[l];
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(r)lx[r]=rx[r]=mx[r]=sum[r];
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> 
		{
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l)lx[l]=rx[l]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,mx[l]=v[x];
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(r)lx[r]=rx[r]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,mx[r]=v[x];
		}
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(rev[x])
	{
		rev[x]^=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;rev[l]^=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;rev[r]^=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		swap(lx[l],rx[l]);swap(lx[r],rx[r]);
		swap(son[l][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],son[l][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);swap(son[r][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],son[r][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
	}
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">rotate</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> &amp;k)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> y=fa[x],z=fa[y],l,r;
	l=(son[y][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]==x);r=l^<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(y==k)k=x;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> son[z][son[z][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]==y]=x;
	fa[son[x][r]]=y;fa[y]=x;fa[x]=z;
	son[y][l]=son[x][r];son[x][r]=y;
	update(y);update(x);
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">splay</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> &amp;k)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(x!=k)
	{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> y=fa[x],z=fa[y];
	    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(y!=k)
		{
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(son[y][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==x^son[z][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==y)rotate(x,k);
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> rotate(y,k);
		}
		rotate(x,k);
	}
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> val)</span>
</span>{
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=rt;
    pushdown(x);
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(val!=sz[son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>){
    	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(val&gt;sz[son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]]){
    		val-=sz[son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
    		x=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
    	}
    	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>{
    		x=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
    	}
    	pushdown(x);
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">rec</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!x)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],r=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	rec(l);rec(r);q.push(x);
	fa[x]=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	tag[x]=rev[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">split</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tt)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=get(k),y=get(k+tt+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
	splay(x,rt);splay(y,son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> son[y][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">modify</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tt,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> val)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=split(k,tt),y=fa[x];
	v[x]=val;tag[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;sum[x]=sz[x]*val;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(val&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>)lx[x]=rx[x]=mx[x]=sum[x];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> lx[x]=rx[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,mx[x]=val;
	update(y);update(fa[y]);
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">rever</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tt)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=split(k,tt),y=fa[x];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!tag[x])
	{
		rev[x]^=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		swap(son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
		swap(lx[x],rx[x]);
		update(y);update(fa[y]);
	}
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">delet</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tt)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=split(k,tt),y=fa[x];
	rec(x);son[y][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	update(y);update(fa[y]);
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">build</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> f)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l&gt;r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=(l+r)&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,now=id[mid],last=id[f];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r)
	{
		sum[now]=a[l];sz[now]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		tag[now]=rev[now]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(a[l]&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>)lx[now]=rx[now]=mx[now]=a[l];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> lx[now]=rx[now]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,mx[now]=a[l];
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> build(l,mid<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>,mid),build(mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,mid);
	v[now]=a[mid];fa[now]=last;update(now);
	son[last][mid&gt;=f]=now;
   }
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">insert</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tt)</span>
</span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=tt;i++)a[i]=read();
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=tt;i++)
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!q.empty())id[i]=q.front(),q.pop();
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> id[i]=++cnt;
	build(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,tt,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>);<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> z=id[(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>+tt)&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=get(k+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>),y=get(k+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>);
	splay(x,rt);splay(y,son[x][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
	fa[z]=y;son[y][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=z;
	update(y);update(x);
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>
</span>{
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//	freopen(&quot;seq2005.in&quot;,&quot;r&quot;,stdin);</span>
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//	freopen(&quot;seq2005.out&quot;,&quot;w&quot;,stdout);</span>
	<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d&quot;</span>,&amp;n,&amp;m);
	mx[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=a[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=a[n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>]=-inf;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>;i&lt;=n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i++)<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,a+i);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>;i++)id[i]=i;
	build(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>);
	rt=(n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>)&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;cnt=n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k,tt,val;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">char</span> op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">19</span>];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=m;++i)
	{
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%s&quot;</span>,op);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]!=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'M'</span>||op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>]!=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'X'</span>)<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d&quot;</span>,&amp;k,&amp;tt);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'I'</span>)insert(k,tt);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'D'</span>)delet(k,tt);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'M'</span>)
		{
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'X'</span>)		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d\n&quot;</span>,mx[rt]);
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> 				<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;val),modify(k,tt,val);
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'R'</span>)rever(k,tt);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(op[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]==<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'G'</span>){<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d\n&quot;</span>,sum[split(k,tt)]);}
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
}
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">1%EF%BC%9A%E6%8F%92%E5%85%A5%20%24INSERT%E2%81%A1%20%5C%20pos_i%20%5C%20tot%20%5C%20c_1%20c_2%E2%8B%AFc_%7Btot%7D%24%0A%0A%E5%9C%A8%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%20%24pos_i%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E5%90%8E%E6%8F%92%E5%85%A5%20%24tot%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%EF%BC%9A%24c_1%2Cc_2%E2%8B%AFc_%7Btot%7D%24%EF%BC%9B%E8%8B%A5%E5%9C%A8%E6%95%B0%E5%88%97%E9%A6%96%E6%8F%92%E5%85%A5%EF%BC%8C%E5%88%99%20%24pos_i%24%20%E4%B8%BA%20%240%24%0A%0A2%EF%BC%9A%E5%88%A0%E9%99%A4%20%24DELETE%20%E2%81%A1%5C%20pos_i%20%5C%20tot%24%0A%0A%E4%BB%8E%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%20%24pos_i%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E5%BC%80%E5%A7%8B%E8%BF%9E%E7%BB%AD%E5%88%A0%E9%99%A4%20%24tot%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%0A%0A3%EF%BC%9A%E4%BF%AE%E6%94%B9%20%24MAKE-SAME%E2%81%A1%20%5C%20pos_i%20%5C%20tot%20%5C%20c%24%0A%0A%E4%BB%8E%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%20%24pos_i%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BF%9E%E7%BB%AD%20%24tot%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E7%BB%9F%E4%B8%80%E4%BF%AE%E6%94%B9%E4%B8%BA%20%24c%24%0A%0A4%EF%BC%9A%E7%BF%BB%E8%BD%AC%20%24REVERSE%E2%81%A1%20%5C%20pos_i%20%5C%20tot%24%0A%0A%E5%8F%96%E5%87%BA%E4%BB%8E%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%20%24pos_i%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E5%BC%80%E5%A7%8B%E7%9A%84%20%24tot%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%EF%BC%8C%E7%BF%BB%E8%BD%AC%E5%90%8E%E6%94%BE%E5%85%A5%E5%8E%9F%E6%9D%A5%E7%9A%84%E4%BD%8D%E7%BD%AE%0A%0A5%EF%BC%9A%E6%B1%82%E5%92%8C%20%24GET-SUM%20%E2%81%A1%5C%20pos_i%20%5C%20tot%24%0A%0A%E8%AE%A1%E7%AE%97%E4%BB%8E%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%20%24pos_i%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E5%BC%80%E5%A7%8B%E7%9A%84%20%24tot%24%20%E4%B8%AA%E6%95%B0%E5%AD%97%E7%9A%84%E5%92%8C%E5%B9%B6%E8%BE%93%E5%87%BA%0A%0A6%EF%BC%9A%E6%B1%82%E5%92%8C%E6%9C%80%E5%A4%A7%E7%9A%84%E5%AD%90%E5%88%97%20%24MAX-SUM%E2%81%A1%24%0A%0A%E6%B1%82%E5%87%BA%E5%BD%93%E5%89%8D%E6%95%B0%E5%88%97%E4%B8%AD%E5%92%8C%E6%9C%80%E5%A4%A7%E7%9A%84%E4%B8%80%E6%AE%B5%E5%AD%90%E5%88%97%EF%BC%8C%E5%B9%B6%E8%BE%93%E5%87%BA%E6%9C%80%E5%A4%A7%E5%92%8C%0A%60%60%60c%2B%2B%0A%23include%3Ciostream%3E%0A%23include%3Ccstdio%3E%0A%23include%3Ccstring%3E%0A%23include%3Calgorithm%3E%0A%23include%3Cqueue%3E%0Ausing%20namespace%20std%3B%0Aconst%20int%20inf%20%3D%201000000000%3B%0Aconst%20int%20N%20%3D%201e6%2B1%3B%0Aint%20read()%0A%7B%0A%09int%20x%3D0%2Cf%3D1%3Bchar%20ch%3Dgetchar()%3B%0A%09while(ch%3C'0'%7C%7Cch%3E'9')%7Bif(ch%3D%3D'-')f%3D-1%3Bch%3Dgetchar()%3B%7D%0A%09while(ch%3E%3D'0'%26%26ch%3C%3D'9')%7Bx%3Dx*10%2Bch-'0'%3Bch%3Dgetchar()%3B%7D%0A%09return%20x*f%3B%0A%7D%0Aint%20n%2Cm%2Crt%2Ccnt%3B%0Aint%20a%5BN%5D%2Cid%5BN%5D%2Cfa%5BN%5D%2Cson%5BN%5D%5B2%5D%3B%0Aint%20sum%5BN%5D%2Csz%5BN%5D%2Cv%5BN%5D%2Cmx%5BN%5D%2Clx%5BN%5D%2Crx%5BN%5D%3B%0Abool%20tag%5BN%5D%2Crev%5BN%5D%3B%0Aqueue%3Cint%3Eq%3B%2F%2Frecycle%0Avoid%20update(int%20x)%0A%7B%0A%09int%20l%3Dson%5Bx%5D%5B0%5D%2Cr%3Dson%5Bx%5D%5B1%5D%3B%0A%09sum%5Bx%5D%3Dsum%5Bl%5D%2Bsum%5Br%5D%2Bv%5Bx%5D%3B%0A%09sz%5Bx%5D%3Dsz%5Bl%5D%2Bsz%5Br%5D%2B1%3B%0A%09mx%5Bx%5D%3Dmax(mx%5Bl%5D%2Cmx%5Br%5D)%3B%0A%09mx%5Bx%5D%3Dmax(mx%5Bx%5D%2Crx%5Bl%5D%2Bv%5Bx%5D%2Blx%5Br%5D)%3B%0A%09lx%5Bx%5D%3Dmax(lx%5Bl%5D%2Csum%5Bl%5D%2Bv%5Bx%5D%2Blx%5Br%5D)%3B%0A%09rx%5Bx%5D%3Dmax(rx%5Br%5D%2Csum%5Br%5D%2Bv%5Bx%5D%2Brx%5Bl%5D)%3B%0A%7D%0Avoid%20pushdown(int%20x)%0A%7B%0A%09int%20l%3Dson%5Bx%5D%5B0%5D%2Cr%3Dson%5Bx%5D%5B1%5D%3B%0A%09if(tag%5Bx%5D)%0A%09%7B%0A%09%09rev%5Bx%5D%3Dtag%5Bx%5D%3D0%3B%0A%09%09if(l)tag%5Bl%5D%3D1%2Cv%5Bl%5D%3Dv%5Bx%5D%2Csum%5Bl%5D%3Dv%5Bx%5D*sz%5Bl%5D%3B%0A%09%09if(r)tag%5Br%5D%3D1%2Cv%5Br%5D%3Dv%5Bx%5D%2Csum%5Br%5D%3Dv%5Bx%5D*sz%5Br%5D%3B%0A%09%09if(v%5Bx%5D%3E%3D0)%0A%09%09%7B%0A%09%09%09if(l)lx%5Bl%5D%3Drx%5Bl%5D%3Dmx%5Bl%5D%3Dsum%5Bl%5D%3B%0A%09%09%09if(r)lx%5Br%5D%3Drx%5Br%5D%3Dmx%5Br%5D%3Dsum%5Br%5D%3B%0A%09%09%7D%0A%09%09else%20%0A%09%09%7B%0A%09%09%09if(l)lx%5Bl%5D%3Drx%5Bl%5D%3D0%2Cmx%5Bl%5D%3Dv%5Bx%5D%3B%0A%09%09%09if(r)lx%5Br%5D%3Drx%5Br%5D%3D0%2Cmx%5Br%5D%3Dv%5Bx%5D%3B%0A%09%09%7D%0A%09%7D%0A%09if(rev%5Bx%5D)%0A%09%7B%0A%09%09rev%5Bx%5D%5E%3D1%3Brev%5Bl%5D%5E%3D1%3Brev%5Br%5D%5E%3D1%3B%0A%09%09swap(lx%5Bl%5D%2Crx%5Bl%5D)%3Bswap(lx%5Br%5D%2Crx%5Br%5D)%3B%0A%09%09swap(son%5Bl%5D%5B0%5D%2Cson%5Bl%5D%5B1%5D)%3Bswap(son%5Br%5D%5B0%5D%2Cson%5Br%5D%5B1%5D)%3B%0A%09%7D%0A%7D%0Avoid%20rotate(int%20x%2Cint%20%26k)%0A%7B%0A%09int%20y%3Dfa%5Bx%5D%2Cz%3Dfa%5By%5D%2Cl%2Cr%3B%0A%09l%3D(son%5By%5D%5B1%5D%3D%3Dx)%3Br%3Dl%5E1%3B%0A%09if(y%3D%3Dk)k%3Dx%3B%0A%09else%20son%5Bz%5D%5Bson%5Bz%5D%5B1%5D%3D%3Dy%5D%3Dx%3B%0A%09fa%5Bson%5Bx%5D%5Br%5D%5D%3Dy%3Bfa%5By%5D%3Dx%3Bfa%5Bx%5D%3Dz%3B%0A%09son%5By%5D%5Bl%5D%3Dson%5Bx%5D%5Br%5D%3Bson%5Bx%5D%5Br%5D%3Dy%3B%0A%09update(y)%3Bupdate(x)%3B%0A%7D%0Avoid%20splay(int%20x%2Cint%20%26k)%0A%7B%0A%09while(x!%3Dk)%0A%09%7B%0A%09%09int%20y%3Dfa%5Bx%5D%2Cz%3Dfa%5By%5D%3B%0A%09%20%20%20%20if(y!%3Dk)%0A%09%09%7B%0A%09%09%09if(son%5By%5D%5B0%5D%3D%3Dx%5Eson%5Bz%5D%5B0%5D%3D%3Dy)rotate(x%2Ck)%3B%0A%09%09%09else%20rotate(y%2Ck)%3B%0A%09%09%7D%0A%09%09rotate(x%2Ck)%3B%0A%09%7D%0A%7D%0Aint%20get(int%20val)%0A%7B%0A%20%20%20%20int%20x%3Drt%3B%0A%20%20%20%20pushdown(x)%3B%0A%20%20%20%20while(val!%3Dsz%5Bson%5Bx%5D%5B0%5D%5D%2B1)%7B%0A%20%20%20%20%09if(val%3Esz%5Bson%5Bx%5D%5B0%5D%5D)%7B%0A%20%20%20%20%09%09val-%3Dsz%5Bson%5Bx%5D%5B0%5D%5D%2B1%3B%0A%20%20%20%20%09%09x%3Dson%5Bx%5D%5B1%5D%3B%0A%20%20%20%20%09%7D%0A%20%20%20%20%09else%7B%0A%20%20%20%20%09%09x%3Dson%5Bx%5D%5B0%5D%3B%0A%20%20%20%20%09%7D%0A%20%20%20%20%09pushdown(x)%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20x%3B%0A%7D%0Avoid%20rec(int%20x)%0A%7B%0A%09if(!x)return%3B%0A%09int%20l%3Dson%5Bx%5D%5B0%5D%2Cr%3Dson%5Bx%5D%5B1%5D%3B%0A%09rec(l)%3Brec(r)%3Bq.push(x)%3B%0A%09fa%5Bx%5D%3Dson%5Bx%5D%5B0%5D%3Dson%5Bx%5D%5B1%5D%3D0%3B%0A%09tag%5Bx%5D%3Drev%5Bx%5D%3D0%3B%0A%7D%0Aint%20split(int%20k%2Cint%20tt)%0A%7B%0A%09int%20x%3Dget(k)%2Cy%3Dget(k%2Btt%2B1)%3B%0A%09splay(x%2Crt)%3Bsplay(y%2Cson%5Bx%5D%5B1%5D)%3B%0A%09return%20son%5By%5D%5B0%5D%3B%0A%7D%0Avoid%20modify(int%20k%2Cint%20tt%2Cint%20val)%0A%7B%0A%09int%20x%3Dsplit(k%2Ctt)%2Cy%3Dfa%5Bx%5D%3B%0A%09v%5Bx%5D%3Dval%3Btag%5Bx%5D%3D1%3Bsum%5Bx%5D%3Dsz%5Bx%5D*val%3B%0A%09if(val%3E%3D0)lx%5Bx%5D%3Drx%5Bx%5D%3Dmx%5Bx%5D%3Dsum%5Bx%5D%3B%0A%09else%20lx%5Bx%5D%3Drx%5Bx%5D%3D0%2Cmx%5Bx%5D%3Dval%3B%0A%09update(y)%3Bupdate(fa%5By%5D)%3B%0A%7D%0Avoid%20rever(int%20k%2Cint%20tt)%0A%7B%0A%09int%20x%3Dsplit(k%2Ctt)%2Cy%3Dfa%5Bx%5D%3B%0A%09if(!tag%5Bx%5D)%0A%09%7B%0A%09%09rev%5Bx%5D%5E%3D1%3B%0A%09%09swap(son%5Bx%5D%5B0%5D%2Cson%5Bx%5D%5B1%5D)%3B%0A%09%09swap(lx%5Bx%5D%2Crx%5Bx%5D)%3B%0A%09%09update(y)%3Bupdate(fa%5By%5D)%3B%0A%09%7D%0A%7D%0Avoid%20delet(int%20k%2Cint%20tt)%0A%7B%0A%09int%20x%3Dsplit(k%2Ctt)%2Cy%3Dfa%5Bx%5D%3B%0A%09rec(x)%3Bson%5By%5D%5B0%5D%3D0%3B%0A%09update(y)%3Bupdate(fa%5By%5D)%3B%0A%7D%0Avoid%20build(int%20l%2Cint%20r%2Cint%20f)%0A%7B%0A%09if(l%3Er)return%3B%0A%09int%20mid%3D(l%2Br)%3E%3E1%2Cnow%3Did%5Bmid%5D%2Clast%3Did%5Bf%5D%3B%0A%09if(l%3D%3Dr)%0A%09%7B%0A%09%09sum%5Bnow%5D%3Da%5Bl%5D%3Bsz%5Bnow%5D%3D1%3B%0A%09%09tag%5Bnow%5D%3Drev%5Bnow%5D%3D0%3B%0A%09%09if(a%5Bl%5D%3E%3D0)lx%5Bnow%5D%3Drx%5Bnow%5D%3Dmx%5Bnow%5D%3Da%5Bl%5D%3B%0A%09%09else%20lx%5Bnow%5D%3Drx%5Bnow%5D%3D0%2Cmx%5Bnow%5D%3Da%5Bl%5D%3B%0A%09%7D%0A%09else%20build(l%2Cmid-1%2Cmid)%2Cbuild(mid%2B1%2Cr%2Cmid)%3B%0A%09v%5Bnow%5D%3Da%5Bmid%5D%3Bfa%5Bnow%5D%3Dlast%3Bupdate(now)%3B%0A%09son%5Blast%5D%5Bmid%3E%3Df%5D%3Dnow%3B%0A%20%20%20%7D%0Avoid%20insert(int%20k%2Cint%20tt)%0A%7B%0A%09for(int%20i%3D1%3Bi%3C%3Dtt%3Bi%2B%2B)a%5Bi%5D%3Dread()%3B%0A%09for(int%20i%3D1%3Bi%3C%3Dtt%3Bi%2B%2B)%0A%09if(!q.empty())id%5Bi%5D%3Dq.front()%2Cq.pop()%3B%0A%09else%20id%5Bi%5D%3D%2B%2Bcnt%3B%0A%09build(1%2Ctt%2C0)%3Bint%20z%3Did%5B(1%2Btt)%3E%3E1%5D%3B%0A%09int%20x%3Dget(k%2B1)%2Cy%3Dget(k%2B2)%3B%0A%09splay(x%2Crt)%3Bsplay(y%2Cson%5Bx%5D%5B1%5D)%3B%0A%09fa%5Bz%5D%3Dy%3Bson%5By%5D%5B0%5D%3Dz%3B%0A%09update(y)%3Bupdate(x)%3B%0A%7D%0Aint%20main()%0A%7B%0A%2F%2F%09freopen(%22seq2005.in%22%2C%22r%22%2Cstdin)%3B%0A%2F%2F%09freopen(%22seq2005.out%22%2C%22w%22%2Cstdout)%3B%0A%09scanf(%22%25d%25d%22%2C%26n%2C%26m)%3B%0A%09mx%5B0%5D%3Da%5B1%5D%3Da%5Bn%2B2%5D%3D-inf%3B%0A%09for(int%20i%3D2%3Bi%3C%3Dn%2B1%3Bi%2B%2B)scanf(%22%25d%22%2Ca%2Bi)%3B%0A%09for(int%20i%3D1%3Bi%3C%3Dn%2B2%3Bi%2B%2B)id%5Bi%5D%3Di%3B%0A%09build(1%2Cn%2B2%2C0)%3B%0A%09rt%3D(n%2B3)%3E%3E1%3Bcnt%3Dn%2B2%3B%0A%09int%20k%2Ctt%2Cval%3B%0A%09char%20op%5B19%5D%3B%0A%09for(int%20i%3D1%3Bi%3C%3Dm%3B%2B%2Bi)%0A%09%7B%0A%09%09scanf(%22%25s%22%2Cop)%3B%0A%09%09if(op%5B0%5D!%3D'M'%7C%7Cop%5B2%5D!%3D'X')scanf(%22%25d%25d%22%2C%26k%2C%26tt)%3B%0A%09%09if(op%5B0%5D%3D%3D'I')insert(k%2Ctt)%3B%0A%09%09if(op%5B0%5D%3D%3D'D')delet(k%2Ctt)%3B%0A%09%09if(op%5B0%5D%3D%3D'M')%0A%09%09%7B%0A%09%09%09if(op%5B2%5D%3D%3D'X')%09%09printf(%22%25d%5Cn%22%2Cmx%5Brt%5D)%3B%0A%09%09%09else%20%09%09%09%09scanf(%22%25d%22%2C%26val)%2Cmodify(k%2Ctt%2Cval)%3B%0A%09%09%7D%0A%09%09if(op%5B0%5D%3D%3D'R')rever(k%2Ctt)%3B%0A%09%09if(op%5B0%5D%3D%3D'G')%7Bprintf(%22%25d%5Cn%22%2Csum%5Bsplit(k%2Ctt)%5D)%3B%7D%0A%09%7D%0A%09return%200%3B%0A%7D%0A%60%60%60</center></span>
</div></body></html> 
<html>
<head>
  <title>快速阶乘</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="653"/>
<h1>快速阶乘</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// luogu-judger-enable-o2</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;cstdio&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;algorithm&gt;</span></span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;cmath&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">262144</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">10</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">typedef</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">unsigned</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> ll;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> P=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">65536</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> SF=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">16</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> msk=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">65535</span>;ll mod;ll PP;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">typedef</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">double</span> ld;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> ld pi=<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">acos</span>(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1.0</span>);
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> ll <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">po</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(ll a,ll p)</span></span>{ll r=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(;p;p&gt;&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,a=a*a%mod)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(p&amp;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)r=r*a%mod;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> r;}
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">cmp</span>
{</span>
    ld r;ld v;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">friend</span> cmp <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">operator</span> +(cmp a,cmp b){<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (cmp){a.r+b.r,a.v+b.v};}
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">friend</span> cmp <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">operator</span> -(cmp a,cmp b){<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (cmp){a.r-b.r,a.v-b.v};}
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">friend</span> cmp <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">operator</span> *(cmp a,cmp b){<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (cmp){a.r*b.r-a.v*b.v,a.r*b.v+a.v*b.r};}
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">operator</span> /=(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>&amp; len){r/=len;v/=len;}
}rt[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">22</span>][N],tr[N],tr1[N],tr2[N],tr3[N],tr4[N],tr5[N],tr6[N];
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> rv[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">22</span>][N];ll m13[N],m14[N],m23[N],m24[N];
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">pre</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>
</span>{
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;d&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">18</span>;d++)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;d);i++)rv[d][i]=(rv[d][i&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)|((i&amp;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)&lt;&lt;(d<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>));
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,t=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;d&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">18</span>;d++,t&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;d);i++)rt[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][d][i]=(cmp){<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">cos</span>(pi*i/t),<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">sin</span>(pi*i/t)};
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,t=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;d&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">18</span>;d++,t&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;d);i++)rt[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][d][i]=(cmp){<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">cos</span>(pi*i/t),-<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">sin</span>(pi*i/t)};
}<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">fft</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(cmp* a,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> len,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> o)</span>
</span>{
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;len;i++)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(i&lt;rv[d][i])swap(a[i],a[rv[d][i]]);cmp* w;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,j=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;k&lt;len;k&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,j++)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> s=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;s&lt;len;s+=(k&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>))
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=s,w=rt[o][j];i&lt;s+k;i++,++w)
                {cmp a1=a[i+k]*(*w);a[i+k]=a[i]-a1;a[i]=a[i]+a1;}
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(o)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)a[i]/=len;
}<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">dbdft</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(ll* a,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> len,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d,cmp* op1,cmp* op2)</span>
</span>{
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)tr[i]=(cmp){(ld)(a[i]&gt;&gt;SF),(ld)(a[i]&amp;msk)};
    fft(tr,len,d,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>);tr[len]=tr[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(cmp* p1=tr,*p2=tr+len,*p3=op1;p1!=tr+len;++p1,--p2,++p3)
        (*p3)=(cmp){p1-&gt;r+p2-&gt;r,p1-&gt;v-p2-&gt;v}*(cmp){<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0.5</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>};
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(cmp* p1=tr,*p2=tr+len,*p3=op2;p1!=tr+len;++p1,--p2,++p3)
        (*p3)=(cmp){p1-&gt;r-p2-&gt;r,p1-&gt;v+p2-&gt;v}*(cmp){<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-0.5</span>};
}<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">dbidft</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(cmp* tr,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> len,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d,ll* a,ll* b)</span>
</span>{
    fft(tr,len,d,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)a[i]=(ll)(tr[i].r+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0.5</span>)%mod;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)b[i]=(ll)(tr[i].v+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0.5</span>)%mod;
}<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">poly_mul</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(ll* a,ll* b,ll* c,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> len,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d)</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//以上都是任意模数fft的板子 </span>
</span>{
    dbdft(a,len,d,tr1,tr2);dbdft(b,len,d,tr3,tr4);
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)tr5[i]=tr1[i]*tr3[i]+(cmp){<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>}*tr2[i]*tr4[i];
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)tr6[i]=tr2[i]*tr3[i]+(cmp){<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>}*tr1[i]*tr4[i];
    dbidft(tr5,len,d,m13,m24);dbidft(tr6,len,d,m23,m14);
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)c[i]=m13[i]*PP%mod;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;len;i++)(c[i]+=(m23[i]+m14[i])*P+m24[i])%=mod;
}<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> iter
{
    ll f[N];ll g[N];ll h[N];ll ifac[N];
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ih</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>
    </span>{
        ifac[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=ifac[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>;i&lt;min((ll)N,mod);i++)ifac[i]=(mod-mod/i)*ifac[mod%i]%mod;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;min((ll)N,mod);i++)(ifac[i]*=ifac[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>])%=mod;
    }<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">calch</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(ll del,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> cur,ll* ip,ll* op)</span>
    </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> len=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(len&lt;=cur+cur+cur)len&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,d++;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur;i++)f[i]=ip[i]*ifac[i]%mod*ifac[cur-i]%mod;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=cur<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;i&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i-=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>)f[i]=(mod-f[i])%mod;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur+cur;i++)g[i]=po((del+mod-cur+i)%mod,mod<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-2</span>); 
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=cur+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;len;i++)f[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=cur+cur+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;len;i++)g[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
        poly_mul(f,g,h,len,d);<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//卷积求出h' </span>
        ll xs=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;ll p1=del-cur;ll p2=del;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=p1;i&lt;=p2;i++)(xs*=i)%=mod;
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur;i++,p1++,p2++)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//双指针求出系数 </span>
        {
            op[i]=h[i+cur]*xs%mod;
            (xs*=po(p1,mod<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-2</span>))%=mod,(xs*=(p2+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>))%=mod;
        }  
    }
}ll val[N];ll fv1[N];ll fv2[N];
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">inline</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">solve</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n)</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//倍增 </span>
</span>{
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> hb=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> p=n;p;p&gt;&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)hb++;val[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> z=hb,cur=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;z&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;z--)
    {
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(cur!=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//把d乘2 </span>
        {
            iter::calch(cur+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,cur,val,fv1);
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur;i++)val[cur+i+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=fv1[i];val[cur&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>|<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
            iter::calch(cur*po(n,mod<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-2</span>)%mod,cur&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,val,fv2);
            cur&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur;i++)(val[i]*=fv2[i])%=mod;
        }<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>((n&gt;&gt;z)&amp;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//把d加1 </span>
        {
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;=cur;i++)(val[i]*=(ll)(n*i)+cur+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)%=mod;cur|=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;val[cur]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=cur;i++)(val[cur]*=(ll)cur*n+i)%=mod;
        }
    }
}
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>
</span>{
    pre();<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n;<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%lld&quot;</span>,&amp;n,&amp;mod);iter::ih();
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> bl=<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">sqrt</span>(n);PP=(ll)P*P%mod;solve(bl);ll res=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,id=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;;i+=bl,id++)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//分块 </span>
    {
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>((ll)i+bl&gt;n){<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> j=i+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;j&lt;=n;j++)(res*=j)%=mod;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">break</span>;}
        (res*=val[id])%=mod;
    }<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%lld&quot;</span>,res);<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//拜拜程序~ </span>
}
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%60%60%60c%2B%2B%0A%2F%2F%20luogu-judger-enable-o2%0A%23include%3Ccstdio%3E%0A%23include%3Calgorithm%3E%0A%23include%3Ccmath%3E%0Ausing%20namespace%20std%3Bconst%20int%20N%3D262144%2B10%3Btypedef%20unsigned%20long%20long%20ll%3B%0Aconst%20int%20P%3D65536%3Bconst%20int%20SF%3D16%3Bconst%20int%20msk%3D65535%3Bll%20mod%3Bll%20PP%3B%0Atypedef%20long%20double%20ld%3Bconst%20ld%20pi%3Dacos(-1.0)%3B%0Ainline%20ll%20po(ll%20a%2Cll%20p)%7Bll%20r%3D1%3Bfor(%3Bp%3Bp%3E%3E%3D1%2Ca%3Da*a%25mod)if(p%261)r%3Dr*a%25mod%3Breturn%20r%3B%7D%0Astruct%20cmp%0A%7B%0A%20%20%20%20ld%20r%3Bld%20v%3B%0A%20%20%20%20friend%20cmp%20operator%20%2B(cmp%20a%2Ccmp%20b)%7Breturn%20(cmp)%7Ba.r%2Bb.r%2Ca.v%2Bb.v%7D%3B%7D%0A%20%20%20%20friend%20cmp%20operator%20-(cmp%20a%2Ccmp%20b)%7Breturn%20(cmp)%7Ba.r-b.r%2Ca.v-b.v%7D%3B%7D%0A%20%20%20%20friend%20cmp%20operator%20*(cmp%20a%2Ccmp%20b)%7Breturn%20(cmp)%7Ba.r*b.r-a.v*b.v%2Ca.r*b.v%2Ba.v*b.r%7D%3B%7D%0A%20%20%20%20void%20operator%20%2F%3D(const%20int%26%20len)%7Br%2F%3Dlen%3Bv%2F%3Dlen%3B%7D%0A%7Drt%5B2%5D%5B22%5D%5BN%5D%2Ctr%5BN%5D%2Ctr1%5BN%5D%2Ctr2%5BN%5D%2Ctr3%5BN%5D%2Ctr4%5BN%5D%2Ctr5%5BN%5D%2Ctr6%5BN%5D%3B%0Aint%20rv%5B22%5D%5BN%5D%3Bll%20m13%5BN%5D%2Cm14%5BN%5D%2Cm23%5BN%5D%2Cm24%5BN%5D%3B%0Ainline%20void%20pre()%0A%7B%0A%20%20%20%20for(int%20d%3D1%3Bd%3C%3D18%3Bd%2B%2B)%0A%20%20%20%20%20%20%20%20for(int%20i%3D1%3Bi%3C(1%3C%3Cd)%3Bi%2B%2B)rv%5Bd%5D%5Bi%5D%3D(rv%5Bd%5D%5Bi%3E%3E1%5D%3E%3E1)%7C((i%261)%3C%3C(d-1))%3B%0A%20%20%20%20for(int%20d%3D1%2Ct%3D1%3Bd%3C%3D18%3Bd%2B%2B%2Ct%3C%3C%3D1)%0A%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C(1%3C%3Cd)%3Bi%2B%2B)rt%5B0%5D%5Bd%5D%5Bi%5D%3D(cmp)%7Bcos(pi*i%2Ft)%2Csin(pi*i%2Ft)%7D%3B%0A%20%20%20%20for(int%20d%3D1%2Ct%3D1%3Bd%3C%3D18%3Bd%2B%2B%2Ct%3C%3C%3D1)%0A%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C(1%3C%3Cd)%3Bi%2B%2B)rt%5B1%5D%5Bd%5D%5Bi%5D%3D(cmp)%7Bcos(pi*i%2Ft)%2C-sin(pi*i%2Ft)%7D%3B%0A%7Dinline%20void%20fft(cmp*%20a%2Cint%20len%2Cint%20d%2Cint%20o)%0A%7B%0A%20%20%20%20for(int%20i%3D1%3Bi%3Clen%3Bi%2B%2B)if(i%3Crv%5Bd%5D%5Bi%5D)swap(a%5Bi%5D%2Ca%5Brv%5Bd%5D%5Bi%5D%5D)%3Bcmp*%20w%3Bint%20i%3B%0A%20%20%20%20for(int%20k%3D1%2Cj%3D1%3Bk%3Clen%3Bk%3C%3C%3D1%2Cj%2B%2B)%0A%20%20%20%20%20%20%20%20for(int%20s%3D0%3Bs%3Clen%3Bs%2B%3D(k%3C%3C1))%0A%20%20%20%20%20%20%20%20%20%20%20%20for(i%3Ds%2Cw%3Drt%5Bo%5D%5Bj%5D%3Bi%3Cs%2Bk%3Bi%2B%2B%2C%2B%2Bw)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Bcmp%20a1%3Da%5Bi%2Bk%5D*(*w)%3Ba%5Bi%2Bk%5D%3Da%5Bi%5D-a1%3Ba%5Bi%5D%3Da%5Bi%5D%2Ba1%3B%7D%0A%20%20%20%20if(o)for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)a%5Bi%5D%2F%3Dlen%3B%0A%7Dinline%20void%20dbdft(ll*%20a%2Cint%20len%2Cint%20d%2Ccmp*%20op1%2Ccmp*%20op2)%0A%7B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)tr%5Bi%5D%3D(cmp)%7B(ld)(a%5Bi%5D%3E%3ESF)%2C(ld)(a%5Bi%5D%26msk)%7D%3B%0A%20%20%20%20fft(tr%2Clen%2Cd%2C0)%3Btr%5Blen%5D%3Dtr%5B0%5D%3B%0A%20%20%20%20for(cmp*%20p1%3Dtr%2C*p2%3Dtr%2Blen%2C*p3%3Dop1%3Bp1!%3Dtr%2Blen%3B%2B%2Bp1%2C--p2%2C%2B%2Bp3)%0A%20%20%20%20%20%20%20%20(*p3)%3D(cmp)%7Bp1-%3Er%2Bp2-%3Er%2Cp1-%3Ev-p2-%3Ev%7D*(cmp)%7B0.5%2C0%7D%3B%0A%20%20%20%20for(cmp*%20p1%3Dtr%2C*p2%3Dtr%2Blen%2C*p3%3Dop2%3Bp1!%3Dtr%2Blen%3B%2B%2Bp1%2C--p2%2C%2B%2Bp3)%0A%20%20%20%20%20%20%20%20(*p3)%3D(cmp)%7Bp1-%3Er-p2-%3Er%2Cp1-%3Ev%2Bp2-%3Ev%7D*(cmp)%7B0%2C-0.5%7D%3B%0A%7Dinline%20void%20dbidft(cmp*%20tr%2Cint%20len%2Cint%20d%2Cll*%20a%2Cll*%20b)%0A%7B%0A%20%20%20%20fft(tr%2Clen%2Cd%2C1)%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)a%5Bi%5D%3D(ll)(tr%5Bi%5D.r%2B0.5)%25mod%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)b%5Bi%5D%3D(ll)(tr%5Bi%5D.v%2B0.5)%25mod%3B%0A%7Dinline%20void%20poly_mul(ll*%20a%2Cll*%20b%2Cll*%20c%2Cint%20len%2Cint%20d)%2F%2F%E4%BB%A5%E4%B8%8A%E9%83%BD%E6%98%AF%E4%BB%BB%E6%84%8F%E6%A8%A1%E6%95%B0fft%E7%9A%84%E6%9D%BF%E5%AD%90%20%0A%7B%0A%20%20%20%20dbdft(a%2Clen%2Cd%2Ctr1%2Ctr2)%3Bdbdft(b%2Clen%2Cd%2Ctr3%2Ctr4)%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)tr5%5Bi%5D%3Dtr1%5Bi%5D*tr3%5Bi%5D%2B(cmp)%7B0%2C1%7D*tr2%5Bi%5D*tr4%5Bi%5D%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)tr6%5Bi%5D%3Dtr2%5Bi%5D*tr3%5Bi%5D%2B(cmp)%7B0%2C1%7D*tr1%5Bi%5D*tr4%5Bi%5D%3B%0A%20%20%20%20dbidft(tr5%2Clen%2Cd%2Cm13%2Cm24)%3Bdbidft(tr6%2Clen%2Cd%2Cm23%2Cm14)%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)c%5Bi%5D%3Dm13%5Bi%5D*PP%25mod%3B%0A%20%20%20%20for(int%20i%3D0%3Bi%3Clen%3Bi%2B%2B)(c%5Bi%5D%2B%3D(m23%5Bi%5D%2Bm14%5Bi%5D)*P%2Bm24%5Bi%5D)%25%3Dmod%3B%0A%7Dnamespace%20iter%0A%7B%0A%20%20%20%20ll%20f%5BN%5D%3Bll%20g%5BN%5D%3Bll%20h%5BN%5D%3Bll%20ifac%5BN%5D%3B%0A%20%20%20%20inline%20void%20ih()%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20ifac%5B0%5D%3Difac%5B1%5D%3D1%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3D2%3Bi%3Cmin((ll)N%2Cmod)%3Bi%2B%2B)ifac%5Bi%5D%3D(mod-mod%2Fi)*ifac%5Bmod%25i%5D%25mod%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3D1%3Bi%3Cmin((ll)N%2Cmod)%3Bi%2B%2B)(ifac%5Bi%5D*%3Difac%5Bi-1%5D)%25%3Dmod%3B%0A%20%20%20%20%7Dinline%20void%20calch(ll%20del%2Cint%20cur%2Cll*%20ip%2Cll*%20op)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20int%20d%3D0%3Bint%20len%3D1%3Bwhile(len%3C%3Dcur%2Bcur%2Bcur)len%3C%3C%3D1%2Cd%2B%2B%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C%3Dcur%3Bi%2B%2B)f%5Bi%5D%3Dip%5Bi%5D*ifac%5Bi%5D%25mod*ifac%5Bcur-i%5D%25mod%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3Dcur-1%3Bi%3E%3D0%3Bi-%3D2)f%5Bi%5D%3D(mod-f%5Bi%5D)%25mod%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C%3Dcur%2Bcur%3Bi%2B%2B)g%5Bi%5D%3Dpo((del%2Bmod-cur%2Bi)%25mod%2Cmod-2)%3B%20%0A%20%20%20%20%20%20%20%20for(int%20i%3Dcur%2B1%3Bi%3Clen%3Bi%2B%2B)f%5Bi%5D%3D0%3Bfor(int%20i%3Dcur%2Bcur%2B1%3Bi%3Clen%3Bi%2B%2B)g%5Bi%5D%3D0%3B%0A%20%20%20%20%20%20%20%20poly_mul(f%2Cg%2Ch%2Clen%2Cd)%3B%2F%2F%E5%8D%B7%E7%A7%AF%E6%B1%82%E5%87%BAh'%20%0A%20%20%20%20%20%20%20%20ll%20xs%3D1%3Bll%20p1%3Ddel-cur%3Bll%20p2%3Ddel%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3Dp1%3Bi%3C%3Dp2%3Bi%2B%2B)(xs*%3Di)%25%3Dmod%3B%0A%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C%3Dcur%3Bi%2B%2B%2Cp1%2B%2B%2Cp2%2B%2B)%2F%2F%E5%8F%8C%E6%8C%87%E9%92%88%E6%B1%82%E5%87%BA%E7%B3%BB%E6%95%B0%20%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20op%5Bi%5D%3Dh%5Bi%2Bcur%5D*xs%25mod%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20(xs*%3Dpo(p1%2Cmod-2))%25%3Dmod%2C(xs*%3D(p2%2B1))%25%3Dmod%3B%0A%20%20%20%20%20%20%20%20%7D%20%20%0A%20%20%20%20%7D%0A%7Dll%20val%5BN%5D%3Bll%20fv1%5BN%5D%3Bll%20fv2%5BN%5D%3B%0Ainline%20void%20solve(int%20n)%2F%2F%E5%80%8D%E5%A2%9E%20%0A%7B%0A%20%20%20%20int%20hb%3D0%3Bfor(int%20p%3Dn%3Bp%3Bp%3E%3E%3D1)hb%2B%2B%3Bval%5B0%5D%3D1%3B%0A%20%20%20%20for(int%20z%3Dhb%2Ccur%3D0%3Bz%3E%3D0%3Bz--)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20if(cur!%3D0)%2F%2F%E6%8A%8Ad%E4%B9%982%20%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20iter%3A%3Acalch(cur%2B1%2Ccur%2Cval%2Cfv1)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C%3Dcur%3Bi%2B%2B)val%5Bcur%2Bi%2B1%5D%3Dfv1%5Bi%5D%3Bval%5Bcur%3C%3C1%7C1%5D%3D0%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20iter%3A%3Acalch(cur*po(n%2Cmod-2)%25mod%2Ccur%3C%3C1%2Cval%2Cfv2)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20cur%3C%3C%3D1%3Bfor(int%20i%3D0%3Bi%3C%3Dcur%3Bi%2B%2B)(val%5Bi%5D*%3Dfv2%5Bi%5D)%25%3Dmod%3B%0A%20%20%20%20%20%20%20%20%7Dif((n%3E%3Ez)%261)%2F%2F%E6%8A%8Ad%E5%8A%A01%20%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20for(int%20i%3D0%3Bi%3C%3Dcur%3Bi%2B%2B)(val%5Bi%5D*%3D(ll)(n*i)%2Bcur%2B1)%25%3Dmod%3Bcur%7C%3D1%3Bval%5Bcur%5D%3D1%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for(int%20i%3D1%3Bi%3C%3Dcur%3Bi%2B%2B)(val%5Bcur%5D*%3D(ll)cur*n%2Bi)%25%3Dmod%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0Aint%20main()%0A%7B%0A%20%20%20%20pre()%3Bint%20n%3Bscanf(%22%25d%25lld%22%2C%26n%2C%26mod)%3Biter%3A%3Aih()%3B%0A%20%20%20%20int%20bl%3Dsqrt(n)%3BPP%3D(ll)P*P%25mod%3Bsolve(bl)%3Bll%20res%3D1%3B%0A%20%20%20%20for(int%20i%3D0%2Cid%3D0%3B%3Bi%2B%3Dbl%2Cid%2B%2B)%2F%2F%E5%88%86%E5%9D%97%20%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20if((ll)i%2Bbl%3En)%7Bfor(int%20j%3Di%2B1%3Bj%3C%3Dn%3Bj%2B%2B)(res*%3Dj)%25%3Dmod%3Bbreak%3B%7D%0A%20%20%20%20%20%20%20%20(res*%3Dval%5Bid%5D)%25%3Dmod%3B%0A%20%20%20%20%7Dprintf(%22%25lld%22%2Cres)%3Breturn%200%3B%2F%2F%E6%8B%9C%E6%8B%9C%E7%A8%8B%E5%BA%8F~%20%0A%7D%0A%60%60%60</center></span>
</div></body></html> 
<html>
<head>
  <title>极大网格图上求联通性相关的问题</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1780"/>
<h1>极大网格图上求联通性相关的问题</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">对于极大网格图上求联通性相关的问题，通常可以利用扫描线算法来解决问题</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">例如给定一个<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8141079999999999em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">2</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">∗</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">0</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -3.063em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">5</span></span></span></span></span></span></span></span></span></span></span>的网格图，在其中放置<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8141079999999999em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03148em; -ms-high-contrast-adjust: none;">k</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">0</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -3.063em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">6</span></span></span></span></span></span></span></span></span></span></span>个障碍。一个人每次可以走向上下左右四个格子(不能走出边界)，求有多少个点对<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.75em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">(</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">y</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">)</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">(</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">2</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">y</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.30110799999999993em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">2</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">)</span></span></span></span>可以互相到达。此时可以考虑逐行计算连通性与方案数，把一行内连续的非障碍看成线段，那么在考虑计算第<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span>行的贡献时，问题转化为两个线段组(每个线段组内线段不相交)的交的问题，可以利用尺取法解决</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;bits/stdc++.h&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e6</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> M = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2e5</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mod = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e9</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">7</span>;

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> T;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,m,k,fa[N*<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>];
<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">vector</span>&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>&gt; g[N*<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>];

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">nd</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,y;
}a[N];

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">line</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,r;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> id;
}l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>][M];

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">func</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> c,f;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">friend</span> func <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">operator</span> + (func a,func b){
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> {(a.c+b.c)%mod,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>(((a.f+b.f)%mod+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*a.c*b.c%mod)%mod)};
	}
}f[N*<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>];

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">gf</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> fa[x]==x?x:fa[x]=gf(fa[x]);
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">work</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> y)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!x||!y)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> fa0=gf(l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][x].id);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> fa1=gf(l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][y].id);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(fa0!=fa1&amp;&amp;min(l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][x].r,l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][y].r)&gt;=max(l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][x].l,l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][y].l)){
		fa[fa1]=fa0;
		f[fa0]=f[fa0]+f[fa1];
	}
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">signed</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
	<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;T);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(T--){
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">static</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> q[N*<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> top=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=k;++i){
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d&quot;</span>,&amp;a[i].x,&amp;a[i].y);
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(a[i].x!=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)q[++top]=a[i].x<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
			q[++top]=a[i].x;
		}
		q[++top]=n;
		sort(q+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,q+top+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
		top=unique(q+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,q+top+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)-q<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=top;++i)g[i].clear();
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=k;++i){
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> p=lower_bound(q+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,q+top+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,a[i].x)-q;
			g[p].push_back(a[i].y);
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>]={<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>};
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> cnt_id=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=top;++i){
			sort(g[i].begin(),g[i].end());
			r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> j=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,x,y;j&lt;=g[i].size();++j){
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(!j)x=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> x=g[i][j<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(j==g[i].size())y=m;
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> y=g[i][j]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(x&gt;y)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">continue</span>;
				l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][++r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]]={x,y,++cnt_id};
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> cnt=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*(y-x+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)*(q[i]-q[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>])%mod;
				f[cnt_id]={cnt,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*cnt*(cnt+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>)/<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>%mod)};
				fa[cnt_id]=cnt_id;
			}
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>]={<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>};
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]&lt;=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]||rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]&lt;=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]){
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span> f0=rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]&lt;=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span> f1=rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]&lt;=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(f0&amp;&amp;f1){
					<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]].l&lt;=l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]].l){
						work(rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>);
						++rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
					}
					<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>{
						work(rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>,rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
						++rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
					}
				}
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(f0){
					work(rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
					++rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];
				}
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>{
					work(r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>],rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>]);
					++rtmp[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
				}
			}
			r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=r[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>];++i)l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>][i]=l[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][i];
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> ans=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=cnt_id;++i)
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(gf(i)==i){
			(ans+=f[i].f)%=mod;
		}
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d\n&quot;</span>,ans);
	}
}
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%E5%AF%B9%E4%BA%8E%E6%9E%81%E5%A4%A7%E7%BD%91%E6%A0%BC%E5%9B%BE%E4%B8%8A%E6%B1%82%E8%81%94%E9%80%9A%E6%80%A7%E7%9B%B8%E5%85%B3%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E9%80%9A%E5%B8%B8%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E6%89%AB%E6%8F%8F%E7%BA%BF%E7%AE%97%E6%B3%95%E6%9D%A5%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%0A%0A%E4%BE%8B%E5%A6%82%E7%BB%99%E5%AE%9A%E4%B8%80%E4%B8%AA%24n%3Dm%3D2*10%5E5%24%E7%9A%84%E7%BD%91%E6%A0%BC%E5%9B%BE%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E6%94%BE%E7%BD%AE%24k%3D10%5E6%24%E4%B8%AA%E9%9A%9C%E7%A2%8D%E3%80%82%E4%B8%80%E4%B8%AA%E4%BA%BA%E6%AF%8F%E6%AC%A1%E5%8F%AF%E4%BB%A5%E8%B5%B0%E5%90%91%E4%B8%8A%E4%B8%8B%E5%B7%A6%E5%8F%B3%E5%9B%9B%E4%B8%AA%E6%A0%BC%E5%AD%90(%E4%B8%8D%E8%83%BD%E8%B5%B0%E5%87%BA%E8%BE%B9%E7%95%8C)%EF%BC%8C%E6%B1%82%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AA%E7%82%B9%E5%AF%B9%24(x_1%2Cy_1)%2C(x_2%2Cy_2)%24%E5%8F%AF%E4%BB%A5%E4%BA%92%E7%9B%B8%E5%88%B0%E8%BE%BE%E3%80%82%E6%AD%A4%E6%97%B6%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E9%80%90%E8%A1%8C%E8%AE%A1%E7%AE%97%E8%BF%9E%E9%80%9A%E6%80%A7%E4%B8%8E%E6%96%B9%E6%A1%88%E6%95%B0%EF%BC%8C%E6%8A%8A%E4%B8%80%E8%A1%8C%E5%86%85%E8%BF%9E%E7%BB%AD%E7%9A%84%E9%9D%9E%E9%9A%9C%E7%A2%8D%E7%9C%8B%E6%88%90%E7%BA%BF%E6%AE%B5%EF%BC%8C%E9%82%A3%E4%B9%88%E5%9C%A8%E8%80%83%E8%99%91%E8%AE%A1%E7%AE%97%E7%AC%AC%24i%24%E8%A1%8C%E7%9A%84%E8%B4%A1%E7%8C%AE%E6%97%B6%EF%BC%8C%E9%97%AE%E9%A2%98%E8%BD%AC%E5%8C%96%E4%B8%BA%E4%B8%A4%E4%B8%AA%E7%BA%BF%E6%AE%B5%E7%BB%84(%E6%AF%8F%E4%B8%AA%E7%BA%BF%E6%AE%B5%E7%BB%84%E5%86%85%E7%BA%BF%E6%AE%B5%E4%B8%8D%E7%9B%B8%E4%BA%A4)%E7%9A%84%E4%BA%A4%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E5%B0%BA%E5%8F%96%E6%B3%95%E8%A7%A3%E5%86%B3%0A%0A%60%60%60c%2B%2B%0A%23include%3Cbits%2Fstdc%2B%2B.h%3E%0Ausing%20namespace%20std%3B%0Aconst%20int%20N%20%3D%201e6%2B5%3B%0Aconst%20int%20M%20%3D%202e5%2B5%3B%0Aconst%20int%20mod%20%3D%201e9%2B7%3B%0A%0Aint%20T%3B%0Aint%20n%2Cm%2Ck%2Cfa%5BN*3%5D%3B%0Avector%3Cint%3E%20g%5BN*2%5D%3B%0A%0Astruct%20nd%7B%0A%09int%20x%2Cy%3B%0A%7Da%5BN%5D%3B%0A%0Astruct%20line%7B%0A%09int%20l%2Cr%3B%0A%09int%20id%3B%0A%7Dl%5B2%5D%5BM%5D%3B%0A%0Astruct%20func%7B%0A%09int%20c%2Cf%3B%0A%09friend%20func%20operator%20%2B%20(func%20a%2Cfunc%20b)%7B%0A%09%09return%20%7B(a.c%2Bb.c)%25mod%2Cint(((a.f%2Bb.f)%25mod%2B1ll*a.c*b.c%25mod)%25mod)%7D%3B%0A%09%7D%0A%7Df%5BN*3%5D%3B%0A%0Aint%20gf(int%20x)%7B%0A%09return%20fa%5Bx%5D%3D%3Dx%3Fx%3Afa%5Bx%5D%3Dgf(fa%5Bx%5D)%3B%0A%7D%0A%0Avoid%20work(int%20x%2Cint%20y)%7B%0A%09if(!x%7C%7C!y)return%3B%0A%09int%20fa0%3Dgf(l%5B0%5D%5Bx%5D.id)%3B%0A%09int%20fa1%3Dgf(l%5B1%5D%5By%5D.id)%3B%0A%09if(fa0!%3Dfa1%26%26min(l%5B0%5D%5Bx%5D.r%2Cl%5B1%5D%5By%5D.r)%3E%3Dmax(l%5B0%5D%5Bx%5D.l%2Cl%5B1%5D%5By%5D.l))%7B%0A%09%09fa%5Bfa1%5D%3Dfa0%3B%0A%09%09f%5Bfa0%5D%3Df%5Bfa0%5D%2Bf%5Bfa1%5D%3B%0A%09%7D%0A%7D%0A%0Asigned%20main()%7B%0A%09scanf(%22%25d%22%2C%26T)%3B%0A%09while(T--)%7B%0A%09%09scanf(%22%25d%25d%25d%22%2C%26n%2C%26m%2C%26k)%3B%0A%09%09static%20int%20q%5BN*2%5D%3B%0A%09%09int%20top%3D0%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dk%3B%2B%2Bi)%7B%0A%09%09%09scanf(%22%25d%25d%22%2C%26a%5Bi%5D.x%2C%26a%5Bi%5D.y)%3B%0A%09%09%09if(a%5Bi%5D.x!%3D1)q%5B%2B%2Btop%5D%3Da%5Bi%5D.x-1%3B%0A%09%09%09q%5B%2B%2Btop%5D%3Da%5Bi%5D.x%3B%0A%09%09%7D%0A%09%09q%5B%2B%2Btop%5D%3Dn%3B%0A%09%09sort(q%2B1%2Cq%2Btop%2B1)%3B%0A%09%09top%3Dunique(q%2B1%2Cq%2Btop%2B1)-q-1%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dtop%3B%2B%2Bi)g%5Bi%5D.clear()%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dk%3B%2B%2Bi)%7B%0A%09%09%09int%20p%3Dlower_bound(q%2B1%2Cq%2Btop%2B1%2Ca%5Bi%5D.x)-q%3B%0A%09%09%09g%5Bp%5D.push_back(a%5Bi%5D.y)%3B%0A%09%09%7D%0A%09%09int%20r%5B2%5D%3D%7B0%2C0%7D%3B%0A%09%09int%20cnt_id%3D0%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dtop%3B%2B%2Bi)%7B%0A%09%09%09sort(g%5Bi%5D.begin()%2Cg%5Bi%5D.end())%3B%0A%09%09%09r%5B1%5D%3D0%3B%0A%09%09%09for(int%20j%3D0%2Cx%2Cy%3Bj%3C%3Dg%5Bi%5D.size()%3B%2B%2Bj)%7B%0A%09%09%09%09if(!j)x%3D1%3B%0A%09%09%09%09else%20x%3Dg%5Bi%5D%5Bj-1%5D%2B1%3B%0A%09%09%09%09if(j%3D%3Dg%5Bi%5D.size())y%3Dm%3B%0A%09%09%09%09else%20y%3Dg%5Bi%5D%5Bj%5D-1%3B%0A%09%09%09%09if(x%3Ey)continue%3B%0A%09%09%09%09l%5B1%5D%5B%2B%2Br%5B1%5D%5D%3D%7Bx%2Cy%2C%2B%2Bcnt_id%7D%3B%0A%09%09%09%09int%20cnt%3D1ll*(y-x%2B1)*(q%5Bi%5D-q%5Bi-1%5D)%25mod%3B%0A%09%09%09%09f%5Bcnt_id%5D%3D%7Bcnt%2Cint(1ll*cnt*(cnt%2B1)%2F2%25mod)%7D%3B%0A%09%09%09%09fa%5Bcnt_id%5D%3Dcnt_id%3B%0A%09%09%09%7D%0A%09%09%09int%20rtmp%5B2%5D%3D%7B1%2C1%7D%3B%0A%09%09%09while(rtmp%5B0%5D%3C%3Dr%5B0%5D%7C%7Crtmp%5B1%5D%3C%3Dr%5B1%5D)%7B%0A%09%09%09%09bool%20f0%3Drtmp%5B0%5D%3C%3Dr%5B0%5D%3B%0A%09%09%09%09bool%20f1%3Drtmp%5B1%5D%3C%3Dr%5B1%5D%3B%0A%09%09%09%09if(f0%26%26f1)%7B%0A%09%09%09%09%09if(l%5B0%5D%5Brtmp%5B0%5D%5D.l%3C%3Dl%5B1%5D%5Brtmp%5B1%5D%5D.l)%7B%0A%09%09%09%09%09%09work(rtmp%5B0%5D%2Crtmp%5B1%5D-1)%3B%0A%09%09%09%09%09%09%2B%2Brtmp%5B0%5D%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%09else%7B%0A%09%09%09%09%09%09work(rtmp%5B0%5D-1%2Crtmp%5B1%5D)%3B%0A%09%09%09%09%09%09%2B%2Brtmp%5B1%5D%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%09else%20if(f0)%7B%0A%09%09%09%09%09work(rtmp%5B0%5D%2Cr%5B1%5D)%3B%0A%09%09%09%09%09%2B%2Brtmp%5B0%5D%3B%0A%09%09%09%09%7D%0A%09%09%09%09else%7B%0A%09%09%09%09%09work(r%5B0%5D%2Crtmp%5B1%5D)%3B%0A%09%09%09%09%09%2B%2Brtmp%5B1%5D%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%09r%5B0%5D%3Dr%5B1%5D%3B%0A%09%09%09for(int%20i%3D1%3Bi%3C%3Dr%5B0%5D%3B%2B%2Bi)l%5B0%5D%5Bi%5D%3Dl%5B1%5D%5Bi%5D%3B%0A%09%09%7D%0A%09%09int%20ans%3D0%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dcnt_id%3B%2B%2Bi)%0A%09%09if(gf(i)%3D%3Di)%7B%0A%09%09%09(ans%2B%3Df%5Bi%5D.f)%25%3Dmod%3B%0A%09%09%7D%0A%09%09printf(%22%25d%5Cn%22%2Cans)%3B%0A%09%7D%0A%7D%0A%60%60%60</center></span>
</div></body></html> 
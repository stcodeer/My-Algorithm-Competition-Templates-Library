<html>
<head>
  <title>后缀数组+ST表+主席树</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1619"/>
<h1>后缀数组+ST表+主席树</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">后缀数组+ST表+主席树求区间第k大<br/>
子串<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.68333em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.891661em; vertical-align: -0.208331em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.05764em; -ms-high-contrast-adjust: none;">S</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.33610799999999996em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: -0.05764em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.05764em; -ms-high-contrast-adjust: none;">S</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.3361079999999999em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: -0.05764em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">+</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">1</span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.208331em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">.</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.05764em; -ms-high-contrast-adjust: none;">S</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.151392em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: -0.05764em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.02778em; -ms-high-contrast-adjust: none;">r</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span>在<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.68333em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.68333em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.05764em; -ms-high-contrast-adjust: none;">S</span></span></span></span>中第<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03148em; -ms-high-contrast-adjust: none;">k</span></span></span></span>次出现的位置</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;bits/stdc++.h&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e5</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> M = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">20</span>;

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> Case;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,Q,f[N][M],rt[N];
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> sa[N],tong[N],wa[N],wb[N],wv[N],rk[N],h[N];
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">char</span> s[N];

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">cmp</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> *r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> a,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> b,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> r[a]==r[b]&amp;&amp;r[a+l]==r[b+l];
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">da</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> m)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i,j,p,*x=wa,*y=wb;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;m;++i)tong[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;n;++i)tong[x[i]=s[i]]++;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;m;++i)tong[i]+=tong[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=n<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;i&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;--i)sa[--tong[x[i]]]=i;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(j=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,p=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;p&lt;n;j&lt;&lt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,m=p){
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(p=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,i=n-j;i&lt;n;++i)y[p++]=i;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;n;++i)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(sa[i]&gt;=j)y[p++]=sa[i]-j;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;n;++i)wv[i]=x[y[i]];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;m;++i)tong[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;n;++i)tong[wv[i]]++;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;m;++i)tong[i]+=tong[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=n<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;i&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;--i)sa[--tong[wv[i]]]=y[i];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(swap(x,y),p=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,x[sa[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;n;++i)
		x[sa[i]]=cmp(y,sa[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>],sa[i],j)?p<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>:p++;
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">calh</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i,j,k=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n;i++)rk[sa[i]]=i;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;i&lt;n;h[rk[i++]]=k)
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(k?k--:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>,j=sa[rk[i]<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>];s[i+k]==s[j+k];k++);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">lcp</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> n-r+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
	l++;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> d=log2(r-l+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> min(f[l][d],f[r-(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;d)+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>][d]);
}

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">CMT</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tot;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> ls[N*M],rs[N*M],w[N*M];
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">init</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=tot;++i)ls[i]=rs[i]=w[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		tot=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">insert</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> y,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> p)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=++tot;
		ls[x]=ls[y];rs[x]=rs[y];
		w[x]=w[y]+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(p&lt;=mid)ls[x]=insert(ls[y],l,mid,p);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> rs[x]=insert(rs[y],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,p);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
	}
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">kth</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> y,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> l;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(w[ls[x]]-w[ls[y]]&gt;=k)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> kth(ls[y],ls[x],l,mid,k);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> kth(rs[y],rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,k-(w[ls[x]]-w[ls[y]]));
	}
}T;

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> L,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> R,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> k)</span></span>{
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">static</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,r,h;
	h=R-L+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
	l=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r=rk[L];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(l!=r){
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(lcp(mid,rk[L])&gt;=h)r=mid;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> l=mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> a=l;
	l=rk[L],r=n;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(l!=r){
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(lcp(rk[L],mid)&gt;=h)l=mid;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> r=mid<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> b=r;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(b-a+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;k)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> T.kth(rt[a<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>],rt[b],<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,k);
}

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
	<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;Case);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(Case--){
		T.init();
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d&quot;</span>,&amp;n,&amp;Q);
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%s&quot;</span>,s);
		da(n+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">255</span>); 
		calh(n);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=n;i&gt;=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;--i)rk[i]=rk[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n;++i)sa[i]++;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n;++i)f[i][<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]=h[i];
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> j=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;j&lt;M;++j)
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i+(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;j)<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>&lt;=n;++i)
		f[i][j]=min(f[i][j<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>],f[i+(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>&lt;&lt;j<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>)][j<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>]);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n;++i)rt[i]=T.insert(rt[i<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span>],<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,sa[i]);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,l,r,k;i&lt;=Q;++i){
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d%d&quot;</span>,&amp;l,&amp;r,&amp;k);
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d\n&quot;</span>,get(l,r,k));
		}
	}
}

</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84%2BST%E8%A1%A8%2B%E4%B8%BB%E5%B8%AD%E6%A0%91%E6%B1%82%E5%8C%BA%E9%97%B4%E7%AC%ACk%E5%A4%A7%0A%E5%AD%90%E4%B8%B2%24S_l%2CS_%7Bl%2B1%7D%2C...%2CS_r%24%E5%9C%A8%24S%24%E4%B8%AD%E7%AC%AC%24k%24%E6%AC%A1%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE%0A%60%60%60c%2B%2B%0A%23include%3Cbits%2Fstdc%2B%2B.h%3E%0Ausing%20namespace%20std%3B%0Aconst%20int%20N%20%3D%201e5%2B5%3B%0Aconst%20int%20M%20%3D%2020%3B%0A%0Aint%20Case%3B%0Aint%20n%2CQ%2Cf%5BN%5D%5BM%5D%2Crt%5BN%5D%3B%0Aint%20sa%5BN%5D%2Ctong%5BN%5D%2Cwa%5BN%5D%2Cwb%5BN%5D%2Cwv%5BN%5D%2Crk%5BN%5D%2Ch%5BN%5D%3B%0Achar%20s%5BN%5D%3B%0A%0Aint%20cmp(int%20*r%2Cint%20a%2Cint%20b%2Cint%20l)%7B%0A%09return%20r%5Ba%5D%3D%3Dr%5Bb%5D%26%26r%5Ba%2Bl%5D%3D%3Dr%5Bb%2Bl%5D%3B%0A%7D%0A%0Avoid%20da(int%20n%2Cint%20m)%7B%0A%09int%20i%2Cj%2Cp%2C*x%3Dwa%2C*y%3Dwb%3B%0A%09for(i%3D0%3Bi%3Cm%3B%2B%2Bi)tong%5Bi%5D%3D0%3B%0A%09for(i%3D0%3Bi%3Cn%3B%2B%2Bi)tong%5Bx%5Bi%5D%3Ds%5Bi%5D%5D%2B%2B%3B%0A%09for(i%3D1%3Bi%3Cm%3B%2B%2Bi)tong%5Bi%5D%2B%3Dtong%5Bi-1%5D%3B%0A%09for(i%3Dn-1%3Bi%3E%3D0%3B--i)sa%5B--tong%5Bx%5Bi%5D%5D%5D%3Di%3B%0A%09for(j%3D1%2Cp%3D1%3Bp%3Cn%3Bj%3C%3C%3D1%2Cm%3Dp)%7B%0A%09%09for(p%3D0%2Ci%3Dn-j%3Bi%3Cn%3B%2B%2Bi)y%5Bp%2B%2B%5D%3Di%3B%0A%09%09for(i%3D0%3Bi%3Cn%3B%2B%2Bi)if(sa%5Bi%5D%3E%3Dj)y%5Bp%2B%2B%5D%3Dsa%5Bi%5D-j%3B%0A%09%09for(i%3D0%3Bi%3Cn%3B%2B%2Bi)wv%5Bi%5D%3Dx%5By%5Bi%5D%5D%3B%0A%09%09for(i%3D0%3Bi%3Cm%3B%2B%2Bi)tong%5Bi%5D%3D0%3B%0A%09%09for(i%3D0%3Bi%3Cn%3B%2B%2Bi)tong%5Bwv%5Bi%5D%5D%2B%2B%3B%0A%09%09for(i%3D1%3Bi%3Cm%3B%2B%2Bi)tong%5Bi%5D%2B%3Dtong%5Bi-1%5D%3B%0A%09%09for(i%3Dn-1%3Bi%3E%3D0%3B--i)sa%5B--tong%5Bwv%5Bi%5D%5D%5D%3Dy%5Bi%5D%3B%0A%09%09for(swap(x%2Cy)%2Cp%3D1%2Cx%5Bsa%5B0%5D%5D%3D0%2Ci%3D1%3Bi%3Cn%3B%2B%2Bi)%0A%09%09x%5Bsa%5Bi%5D%5D%3Dcmp(y%2Csa%5Bi-1%5D%2Csa%5Bi%5D%2Cj)%3Fp-1%3Ap%2B%2B%3B%0A%09%7D%0A%09return%3B%0A%7D%0A%0Avoid%20calh(int%20n)%7B%0A%09int%20i%2Cj%2Ck%3D0%3B%0A%09for(i%3D1%3Bi%3C%3Dn%3Bi%2B%2B)rk%5Bsa%5Bi%5D%5D%3Di%3B%0A%09for(i%3D0%3Bi%3Cn%3Bh%5Brk%5Bi%2B%2B%5D%5D%3Dk)%0A%09for(k%3Fk--%3A0%2Cj%3Dsa%5Brk%5Bi%5D-1%5D%3Bs%5Bi%2Bk%5D%3D%3Ds%5Bj%2Bk%5D%3Bk%2B%2B)%3B%0A%09return%3B%0A%7D%0A%0Aint%20lcp(int%20l%2Cint%20r)%7B%0A%09if(l%3D%3Dr)return%20n-r%2B1%3B%0A%09l%2B%2B%3B%0A%09int%20d%3Dlog2(r-l%2B1)%3B%0A%09return%20min(f%5Bl%5D%5Bd%5D%2Cf%5Br-(1%3C%3Cd)%2B1%5D%5Bd%5D)%3B%0A%7D%0A%0Astruct%20CMT%7B%0A%09int%20tot%3B%0A%09int%20ls%5BN*M%5D%2Crs%5BN*M%5D%2Cw%5BN*M%5D%3B%0A%09void%20init()%7B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dtot%3B%2B%2Bi)ls%5Bi%5D%3Drs%5Bi%5D%3Dw%5Bi%5D%3D0%3B%0A%09%09tot%3D0%3B%0A%09%7D%0A%09int%20insert(int%20y%2Cint%20l%2Cint%20r%2Cint%20p)%7B%0A%09%09int%20x%3D%2B%2Btot%3B%0A%09%09ls%5Bx%5D%3Dls%5By%5D%3Brs%5Bx%5D%3Drs%5By%5D%3B%0A%09%09w%5Bx%5D%3Dw%5By%5D%2B1%3B%0A%09%09if(l%3D%3Dr)return%20x%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(p%3C%3Dmid)ls%5Bx%5D%3Dinsert(ls%5By%5D%2Cl%2Cmid%2Cp)%3B%0A%09%09else%20rs%5Bx%5D%3Dinsert(rs%5By%5D%2Cmid%2B1%2Cr%2Cp)%3B%0A%09%09return%20x%3B%0A%09%7D%0A%09int%20kth(int%20y%2Cint%20x%2Cint%20l%2Cint%20r%2Cint%20k)%7B%0A%09%09if(l%3D%3Dr)return%20l%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(w%5Bls%5Bx%5D%5D-w%5Bls%5By%5D%5D%3E%3Dk)return%20kth(ls%5By%5D%2Cls%5Bx%5D%2Cl%2Cmid%2Ck)%3B%0A%09%09else%20return%20kth(rs%5By%5D%2Crs%5Bx%5D%2Cmid%2B1%2Cr%2Ck-(w%5Bls%5Bx%5D%5D-w%5Bls%5By%5D%5D))%3B%0A%09%7D%0A%7DT%3B%0A%0Aint%20get(int%20L%2Cint%20R%2Cint%20k)%7B%0A%09static%20int%20l%2Cr%2Ch%3B%0A%09h%3DR-L%2B1%3B%0A%09l%3D1%2Cr%3Drk%5BL%5D%3B%0A%09while(l!%3Dr)%7B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(lcp(mid%2Crk%5BL%5D)%3E%3Dh)r%3Dmid%3B%0A%09%09else%20l%3Dmid%2B1%3B%0A%09%7D%0A%09int%20a%3Dl%3B%0A%09l%3Drk%5BL%5D%2Cr%3Dn%3B%0A%09while(l!%3Dr)%7B%0A%09%09int%20mid%3Dl%2Br%2B1%3E%3E1%3B%0A%09%09if(lcp(rk%5BL%5D%2Cmid)%3E%3Dh)l%3Dmid%3B%0A%09%09else%20r%3Dmid-1%3B%0A%09%7D%0A%09int%20b%3Dr%3B%0A%09if(b-a%2B1%3Ck)return%20-1%3B%0A%09return%20T.kth(rt%5Ba-1%5D%2Crt%5Bb%5D%2C1%2Cn%2Ck)%3B%0A%7D%0A%0Aint%20main()%7B%0A%09scanf(%22%25d%22%2C%26Case)%3B%0A%09while(Case--)%7B%0A%09%09T.init()%3B%0A%09%09scanf(%22%25d%25d%22%2C%26n%2C%26Q)%3B%0A%09%09scanf(%22%25s%22%2Cs)%3B%0A%09%09da(n%2B1%2C255)%3B%20%0A%09%09calh(n)%3B%0A%09%09for(int%20i%3Dn%3Bi%3E%3D1%3B--i)rk%5Bi%5D%3Drk%5Bi-1%5D%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dn%3B%2B%2Bi)sa%5Bi%5D%2B%2B%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dn%3B%2B%2Bi)f%5Bi%5D%5B0%5D%3Dh%5Bi%5D%3B%0A%09%09for(int%20j%3D1%3Bj%3CM%3B%2B%2Bj)%0A%09%09for(int%20i%3D1%3Bi%2B(1%3C%3Cj)-1%3C%3Dn%3B%2B%2Bi)%0A%09%09f%5Bi%5D%5Bj%5D%3Dmin(f%5Bi%5D%5Bj-1%5D%2Cf%5Bi%2B(1%3C%3Cj-1)%5D%5Bj-1%5D)%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dn%3B%2B%2Bi)rt%5Bi%5D%3DT.insert(rt%5Bi-1%5D%2C1%2Cn%2Csa%5Bi%5D)%3B%0A%09%09for(int%20i%3D1%2Cl%2Cr%2Ck%3Bi%3C%3DQ%3B%2B%2Bi)%7B%0A%09%09%09scanf(%22%25d%25d%25d%22%2C%26l%2C%26r%2C%26k)%3B%0A%09%09%09printf(%22%25d%5Cn%22%2Cget(l%2Cr%2Ck))%3B%0A%09%09%7D%0A%09%7D%0A%7D%0A%0A%60%60%60</center></span>
</div></body></html> 
<html>
<head>
  <title>吉司机线段树区间取min</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/603450 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="801"/>
<h1>吉司机线段树区间取min</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">给定一个序列，要求实现区间取<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span></span></span></span>（即区间内<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.58056em; vertical-align: -0.15em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span></span></span></span>更新为<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.75em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">(</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; margin-right: -2px; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.31166399999999994em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span></span></span></span><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; font-size: 1px; -ms-high-contrast-adjust: none;">​</span></span><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.15em; -ms-high-contrast-adjust: none;"></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">)</span></span></span></span>），区间求<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，区间求<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">u</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span></span></span></span>。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">做法：</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">维护区间最大值<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，区间严格次大值<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，区间最大值出现的次数<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，然后进行分类讨论：</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1、<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.73354em; vertical-align: -0.0391em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">&gt;</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，明显对区间无影响，退出；</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">2、<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.73354em; vertical-align: -0.0391em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">&lt;</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">&lt;</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，此时<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>会被更改成<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span></span></span></span>，而<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.625em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">,</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.16666666666666666em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>则不变，对区间和<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">u</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span></span></span></span>的贡献为<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.75em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">(</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">−</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">)</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">∗</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2222222222222222em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>；（此处不能使<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span></span></span></span>，否则在更新后<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，此时<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">c</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>也需要改变）</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">3、<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.73354em; vertical-align: -0.0391em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">v</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">a</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">&lt;</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">=</span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; border: 0 solid; position: relative; margin-right: 0.2777777777777778em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>，跳到当前节点的两个子节点去处理这种情况再<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.69444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8888799999999999em; vertical-align: -0.19444em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">u</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">s</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">h</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">u</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">p</span></span></span></span>回来。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在以上算法中，区间取<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span></span></span></span>操作实际上被转化为了对区间的最大值集体减小一个数的操作，且这次操作不会让最大值比严格次大值更小。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">另外，我们发现<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.43056em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">x</span></span></span></span>本身就可以作为取<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.65952em; vertical-align: 0em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">m</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">i</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span></span></span></span>的标记，所以我们无需另外打标记。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">时间复杂度为<span style="font: normal 1.21em KaTeX_Main,Times New Roman,serif; white-space: nowrap; text-indent: 0; text-rendering: auto; line-height: 160%; box-sizing: content-box;"><span style="line-height: 160%; box-sizing: content-box; clip: rect(1px,1px,1px,1px); padding: 0; border: 0; overflow: hidden; position: fixed; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; height: 1.064108em; vertical-align: -0.25em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; position: relative; display: inline-block; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.02778em; -ms-high-contrast-adjust: none;">O</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">(</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.01968em; -ms-high-contrast-adjust: none;">l</span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">o</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; margin-right: 0.03588em; -ms-high-contrast-adjust: none;">g</span><span style="line-height: 160%; box-sizing: content-box; text-align: left; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-table; table-layout: fixed; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-row; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: table-cell; vertical-align: bottom; position: relative; height: 0.8141079999999999em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: block; height: 0; position: relative; top: -3.063em; margin-right: 0.05em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; display: inline-block; overflow: hidden; width: 0; height: 2.7em; -ms-high-contrast-adjust: none;"></span><span style="line-height: 160%; box-sizing: content-box; display: inline-block; font-size: .7em; -ms-high-contrast-adjust: none;"><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">2</span></span></span></span></span></span></span></span><span style="line-height: 160%; box-sizing: content-box; font-family: KaTeX_Math; font-style: italic; -ms-high-contrast-adjust: none;">n</span><span style="line-height: 160%; box-sizing: content-box; -ms-high-contrast-adjust: none;">)</span></span></span></span>。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">#<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">include</span><span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&lt;bits/stdc++.h&gt;</span></span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">using</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">namespace</span> <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">typedef</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">long</span> ll;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1e6</span>+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>;

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> Case;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> n,m;
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> a[N];

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">STB</span>{</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> tot;
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> ls[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>],rs[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mx[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//区间最大值</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> sx[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//区间严格次大值</span>
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> cx[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//区间最大值出现的次数</span>
	ll sum[N&lt;&lt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>];

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">up</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span></span>{
	    sum[x]=sum[ls[x]]+sum[rs[x]];
	    mx[x]=max(mx[ls[x]],mx[rs[x]]);
	    sx[x]=max(sx[ls[x]],sx[rs[x]]);
	    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mx[ls[x]]!=mx[rs[x]])sx[x]=max(sx[x],min(mx[ls[x]],mx[rs[x]]));
	    cx[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mx[x]==mx[ls[x]])cx[x]+=cx[ls[x]];
	    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mx[x]==mx[rs[x]])cx[x]+=cx[rs[x]];
	}
	
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">build</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x=++tot;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(l==r){
			mx[x]=sum[x]=a[l];
			sx[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1e9</span>;
			cx[x]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
		}
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		ls[x]=build(l,mid);
		rs[x]=build(mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r);
		up(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> x;
	}
	
	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">downmin</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> val)</span></span>{
		sum[x]-=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1l</span>l*(mx[x]-val)*cx[x];
		mx[x]=val;
	}

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">down</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mx[x]&lt;mx[ls[x]])downmin(ls[x],mx[x]);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(mx[x]&lt;mx[rs[x]])downmin(rs[x],mx[x]);
	}

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">changemin</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> L,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> R,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> val)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(val&gt;=mx[x])<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=l&amp;&amp;r&lt;=R&amp;&amp;val&gt;sx[x]){
			downmin(x,val);
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>;
		}
		down(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=mid)changemin(ls[x],l,mid,L,R,val);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(R&gt;mid)changemin(rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,L,R,val);
		up(x);
	}

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ll <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">getsum</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> L,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> R)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> sum[x];
		down(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		ll sum=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=mid)sum+=getsum(ls[x],l,mid,L,R);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(R&gt;mid)sum+=getsum(rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,L,R);
		up(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> sum;
	}

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">getmax</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> x,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> l,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> r,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> L,<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> R)</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> mx[x];
		down(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mid=l+r&gt;&gt;<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> mx=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(L&lt;=mid)mx=max(mx,getmax(ls[x],l,mid,L,R));
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(R&gt;mid)mx=max(mx,getmax(rs[x],mid+<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,r,L,R));
		up(x);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> mx;
	}

	<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">clear</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=tot;++i){
			ls[i]=rs[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
			mx[i]=sx[i]=cx[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
			sum[i]=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
		}
		tot=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;
	}
}T;

<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span></span>{
	<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;Case);
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span>(Case--){
		<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d&quot;</span>,&amp;n,&amp;m);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>;i&lt;=n;++i)<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;a[i]);
		T.clear();
		T.build(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n);
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span>(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,o,x,y,t;i&lt;=m;++i){
			<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d%d%d&quot;</span>,&amp;o,&amp;x,&amp;y);
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(o==<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>){
				<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">scanf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d&quot;</span>,&amp;t);
				T.changemin(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,x,y,t);
			}
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span>(o==<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>){
				<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%d\n&quot;</span>,T.getmax(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,x,y));
			}
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>{
				<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">printf</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;%lld\n&quot;</span>,T.getsum(<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>,n,x,y));
			}
		}
	}
}
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%E7%BB%99%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%BA%8F%E5%88%97%EF%BC%8C%E8%A6%81%E6%B1%82%E5%AE%9E%E7%8E%B0%E5%8C%BA%E9%97%B4%E5%8F%96%24min%24%EF%BC%88%E5%8D%B3%E5%8C%BA%E9%97%B4%E5%86%85%24a_i%24%E6%9B%B4%E6%96%B0%E4%B8%BA%24min(a_i%2Cval)%24%EF%BC%89%EF%BC%8C%E5%8C%BA%E9%97%B4%E6%B1%82%24max%24%EF%BC%8C%E5%8C%BA%E9%97%B4%E6%B1%82%24sum%24%E3%80%82%0A%0A%E5%81%9A%E6%B3%95%EF%BC%9A%0A%0A%E7%BB%B4%E6%8A%A4%E5%8C%BA%E9%97%B4%E6%9C%80%E5%A4%A7%E5%80%BC%24mx%24%EF%BC%8C%E5%8C%BA%E9%97%B4%E4%B8%A5%E6%A0%BC%E6%AC%A1%E5%A4%A7%E5%80%BC%24sx%24%EF%BC%8C%E5%8C%BA%E9%97%B4%E6%9C%80%E5%A4%A7%E5%80%BC%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0%24cx%24%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%88%86%E7%B1%BB%E8%AE%A8%E8%AE%BA%EF%BC%9A%0A%0A%E3%80%80%E3%80%801%E3%80%81%24val%3E%3Dmx%24%EF%BC%8C%E6%98%8E%E6%98%BE%E5%AF%B9%E5%8C%BA%E9%97%B4%E6%97%A0%E5%BD%B1%E5%93%8D%EF%BC%8C%E9%80%80%E5%87%BA%EF%BC%9B%0A%0A%E3%80%80%E3%80%802%E3%80%81%24sx%3Cval%3Cmx%24%EF%BC%8C%E6%AD%A4%E6%97%B6%24mx%24%E4%BC%9A%E8%A2%AB%E6%9B%B4%E6%94%B9%E6%88%90%24val%24%EF%BC%8C%E8%80%8C%24sx%2Ccx%24%E5%88%99%E4%B8%8D%E5%8F%98%EF%BC%8C%E5%AF%B9%E5%8C%BA%E9%97%B4%E5%92%8C%24sum%24%E7%9A%84%E8%B4%A1%E7%8C%AE%E4%B8%BA%24(mx-val)*cx%24%EF%BC%9B%EF%BC%88%E6%AD%A4%E5%A4%84%E4%B8%8D%E8%83%BD%E4%BD%BF%24sx%3Dval%24%EF%BC%8C%E5%90%A6%E5%88%99%E5%9C%A8%E6%9B%B4%E6%96%B0%E5%90%8E%24mx%3Dcx%24%EF%BC%8C%E6%AD%A4%E6%97%B6%24cx%24%E4%B9%9F%E9%9C%80%E8%A6%81%E6%94%B9%E5%8F%98%EF%BC%89%0A%0A%E3%80%80%E3%80%803%E3%80%81%24val%3C%3Dsx%24%EF%BC%8C%E8%B7%B3%E5%88%B0%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%AD%90%E8%8A%82%E7%82%B9%E5%8E%BB%E5%A4%84%E7%90%86%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E5%86%8D%24pushup%24%E5%9B%9E%E6%9D%A5%E3%80%82%0A%20%20%0A%E5%9C%A8%E4%BB%A5%E4%B8%8A%E7%AE%97%E6%B3%95%E4%B8%AD%EF%BC%8C%E5%8C%BA%E9%97%B4%E5%8F%96%24min%24%E6%93%8D%E4%BD%9C%E5%AE%9E%E9%99%85%E4%B8%8A%E8%A2%AB%E8%BD%AC%E5%8C%96%E4%B8%BA%E4%BA%86%E5%AF%B9%E5%8C%BA%E9%97%B4%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%E9%9B%86%E4%BD%93%E5%87%8F%E5%B0%8F%E4%B8%80%E4%B8%AA%E6%95%B0%E7%9A%84%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%B8%94%E8%BF%99%E6%AC%A1%E6%93%8D%E4%BD%9C%E4%B8%8D%E4%BC%9A%E8%AE%A9%E6%9C%80%E5%A4%A7%E5%80%BC%E6%AF%94%E4%B8%A5%E6%A0%BC%E6%AC%A1%E5%A4%A7%E5%80%BC%E6%9B%B4%E5%B0%8F%E3%80%82%0A%0A%E5%8F%A6%E5%A4%96%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%91%E7%8E%B0%24mx%24%E6%9C%AC%E8%BA%AB%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E5%8F%96%24min%24%E7%9A%84%E6%A0%87%E8%AE%B0%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E6%97%A0%E9%9C%80%E5%8F%A6%E5%A4%96%E6%89%93%E6%A0%87%E8%AE%B0%E3%80%82%0A%0A%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%B8%BA%24O(log%5E2n)%24%E3%80%82%0A%60%60%60c%2B%2B%0A%23include%3Cbits%2Fstdc%2B%2B.h%3E%0Ausing%20namespace%20std%3B%0Atypedef%20long%20long%20ll%3B%0Aconst%20int%20N%20%3D%201e6%2B5%3B%0A%0Aint%20Case%3B%0Aint%20n%2Cm%3B%0Aint%20a%5BN%5D%3B%0A%0Astruct%20STB%7B%0A%09int%20tot%3B%0A%09int%20ls%5BN%3C%3C1%5D%2Crs%5BN%3C%3C1%5D%3B%0A%09int%20mx%5BN%3C%3C1%5D%3B%2F%2F%E5%8C%BA%E9%97%B4%E6%9C%80%E5%A4%A7%E5%80%BC%0A%09int%20sx%5BN%3C%3C1%5D%3B%2F%2F%E5%8C%BA%E9%97%B4%E4%B8%A5%E6%A0%BC%E6%AC%A1%E5%A4%A7%E5%80%BC%0A%09int%20cx%5BN%3C%3C1%5D%3B%2F%2F%E5%8C%BA%E9%97%B4%E6%9C%80%E5%A4%A7%E5%80%BC%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0%0A%09ll%20sum%5BN%3C%3C1%5D%3B%0A%0A%09void%20up(int%20x)%7B%0A%09%20%20%20%20sum%5Bx%5D%3Dsum%5Bls%5Bx%5D%5D%2Bsum%5Brs%5Bx%5D%5D%3B%0A%09%20%20%20%20mx%5Bx%5D%3Dmax(mx%5Bls%5Bx%5D%5D%2Cmx%5Brs%5Bx%5D%5D)%3B%0A%09%20%20%20%20sx%5Bx%5D%3Dmax(sx%5Bls%5Bx%5D%5D%2Csx%5Brs%5Bx%5D%5D)%3B%0A%09%20%20%20%20if(mx%5Bls%5Bx%5D%5D!%3Dmx%5Brs%5Bx%5D%5D)sx%5Bx%5D%3Dmax(sx%5Bx%5D%2Cmin(mx%5Bls%5Bx%5D%5D%2Cmx%5Brs%5Bx%5D%5D))%3B%0A%09%20%20%20%20cx%5Bx%5D%3D0%3B%0A%09%20%20%20%20if(mx%5Bx%5D%3D%3Dmx%5Bls%5Bx%5D%5D)cx%5Bx%5D%2B%3Dcx%5Bls%5Bx%5D%5D%3B%0A%09%20%20%20%20if(mx%5Bx%5D%3D%3Dmx%5Brs%5Bx%5D%5D)cx%5Bx%5D%2B%3Dcx%5Brs%5Bx%5D%5D%3B%0A%09%7D%0A%09%0A%09int%20build(int%20l%2Cint%20r)%7B%0A%09%09int%20x%3D%2B%2Btot%3B%0A%09%09if(l%3D%3Dr)%7B%0A%09%09%09mx%5Bx%5D%3Dsum%5Bx%5D%3Da%5Bl%5D%3B%0A%09%09%09sx%5Bx%5D%3D-1e9%3B%0A%09%09%09cx%5Bx%5D%3D1%3B%0A%09%09%09return%20x%3B%0A%09%09%7D%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09ls%5Bx%5D%3Dbuild(l%2Cmid)%3B%0A%09%09rs%5Bx%5D%3Dbuild(mid%2B1%2Cr)%3B%0A%09%09up(x)%3B%0A%09%09return%20x%3B%0A%09%7D%0A%09%0A%09void%20downmin(int%20x%2Cint%20val)%7B%0A%09%09sum%5Bx%5D-%3D1ll*(mx%5Bx%5D-val)*cx%5Bx%5D%3B%0A%09%09mx%5Bx%5D%3Dval%3B%0A%09%7D%0A%0A%09void%20down(int%20x)%7B%0A%09%09if(mx%5Bx%5D%3Cmx%5Bls%5Bx%5D%5D)downmin(ls%5Bx%5D%2Cmx%5Bx%5D)%3B%0A%09%09if(mx%5Bx%5D%3Cmx%5Brs%5Bx%5D%5D)downmin(rs%5Bx%5D%2Cmx%5Bx%5D)%3B%0A%09%7D%0A%0A%09void%20changemin(int%20x%2Cint%20l%2Cint%20r%2Cint%20L%2Cint%20R%2Cint%20val)%7B%0A%09%09if(val%3E%3Dmx%5Bx%5D)return%3B%0A%09%09if(L%3C%3Dl%26%26r%3C%3DR%26%26val%3Esx%5Bx%5D)%7B%0A%09%09%09downmin(x%2Cval)%3B%0A%09%09%09return%3B%0A%09%09%7D%0A%09%09down(x)%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09if(L%3C%3Dmid)changemin(ls%5Bx%5D%2Cl%2Cmid%2CL%2CR%2Cval)%3B%0A%09%09if(R%3Emid)changemin(rs%5Bx%5D%2Cmid%2B1%2Cr%2CL%2CR%2Cval)%3B%0A%09%09up(x)%3B%0A%09%7D%0A%0A%09ll%20getsum(int%20x%2Cint%20l%2Cint%20r%2Cint%20L%2Cint%20R)%7B%0A%09%09if(L%3C%3Dl%26%26r%3C%3DR)return%20sum%5Bx%5D%3B%0A%09%09down(x)%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09ll%20sum%3D0%3B%0A%09%09if(L%3C%3Dmid)sum%2B%3Dgetsum(ls%5Bx%5D%2Cl%2Cmid%2CL%2CR)%3B%0A%09%09if(R%3Emid)sum%2B%3Dgetsum(rs%5Bx%5D%2Cmid%2B1%2Cr%2CL%2CR)%3B%0A%09%09up(x)%3B%0A%09%09return%20sum%3B%0A%09%7D%0A%0A%09int%20getmax(int%20x%2Cint%20l%2Cint%20r%2Cint%20L%2Cint%20R)%7B%0A%09%09if(L%3C%3Dl%26%26r%3C%3DR)return%20mx%5Bx%5D%3B%0A%09%09down(x)%3B%0A%09%09int%20mid%3Dl%2Br%3E%3E1%3B%0A%09%09int%20mx%3D0%3B%0A%09%09if(L%3C%3Dmid)mx%3Dmax(mx%2Cgetmax(ls%5Bx%5D%2Cl%2Cmid%2CL%2CR))%3B%0A%09%09if(R%3Emid)mx%3Dmax(mx%2Cgetmax(rs%5Bx%5D%2Cmid%2B1%2Cr%2CL%2CR))%3B%0A%09%09up(x)%3B%0A%09%09return%20mx%3B%0A%09%7D%0A%0A%09void%20clear()%7B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dtot%3B%2B%2Bi)%7B%0A%09%09%09ls%5Bi%5D%3Drs%5Bi%5D%3D0%3B%0A%09%09%09mx%5Bi%5D%3Dsx%5Bi%5D%3Dcx%5Bi%5D%3D0%3B%0A%09%09%09sum%5Bi%5D%3D0%3B%0A%09%09%7D%0A%09%09tot%3D0%3B%0A%09%7D%0A%7DT%3B%0A%0Aint%20main()%7B%0A%09scanf(%22%25d%22%2C%26Case)%3B%0A%09while(Case--)%7B%0A%09%09scanf(%22%25d%25d%22%2C%26n%2C%26m)%3B%0A%09%09for(int%20i%3D1%3Bi%3C%3Dn%3B%2B%2Bi)scanf(%22%25d%22%2C%26a%5Bi%5D)%3B%0A%09%09T.clear()%3B%0A%09%09T.build(1%2Cn)%3B%0A%09%09for(int%20i%3D1%2Co%2Cx%2Cy%2Ct%3Bi%3C%3Dm%3B%2B%2Bi)%7B%0A%09%09%09scanf(%22%25d%25d%25d%22%2C%26o%2C%26x%2C%26y)%3B%0A%09%09%09if(o%3D%3D0)%7B%0A%09%09%09%09scanf(%22%25d%22%2C%26t)%3B%0A%09%09%09%09T.changemin(1%2C1%2Cn%2Cx%2Cy%2Ct)%3B%0A%09%09%09%7D%0A%09%09%09else%20if(o%3D%3D1)%7B%0A%09%09%09%09printf(%22%25d%5Cn%22%2CT.getmax(1%2C1%2Cn%2Cx%2Cy))%3B%0A%09%09%09%7D%0A%09%09%09else%7B%0A%09%09%09%09printf(%22%25lld%5Cn%22%2CT.getsum(1%2C1%2Cn%2Cx%2Cy))%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%0A%60%60%60</center></span>
</div></body></html> 